

2025-09-02T09:13:02.620582597Z ==> Running 'uvicorn api_server:app --host 0.0.0.0 --port $PORT'
2025-09-02T09:13:27.221180444Z INFO:     Started server process [37]
2025-09-02T09:13:27.221230655Z INFO:     Waiting for application startup.
2025-09-02T09:13:28.203683237Z INFO:     Application startup complete.
2025-09-02T09:13:28.205214047Z INFO:     Uvicorn running on http://0.0.0.0:10000 (Press CTRL+C to quit)
2025-09-02T09:13:29Z clientIP="113.68.252.164" requestID="129103f0-8ea6-4ba5" responseTimeMS=61254 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:29.619498755Z Database tables created/verified
2025-09-02T09:13:29.619520775Z INFO:     113.68.252.164:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_022141_B536F26B/register-user HTTP/1.1" 200 OK
2025-09-02T09:13:29.630273335Z 2025-09-02 09:13:29,628 - backend.services.chinese_payment_service - INFO - Fetching brand list from Chinese API (cache miss)
2025-09-02T09:13:29.630291546Z 2025-09-02 09:13:29,628 - backend.services.chinese_payment_service - INFO - Authenticating with Chinese API
2025-09-02T09:13:29.630296646Z 2025-09-02 09:13:29,628 - backend.services.chinese_payment_service - DEBUG - Signature string: taharizvi.ai@gmail.comEN112233mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:13:29.630301666Z 2025-09-02 09:13:29,629 - backend.services.chinese_payment_service - DEBUG - Generated signature: a22664d06749e18629f68935d2a63755
2025-09-02T09:13:29Z clientIP="223.160.225.168" requestID="b2337927-3379-4b4f" responseTimeMS=10780 responseBytes=76 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:30.516559188Z 2025-09-02 09:13:30,516 - backend.services.chinese_payment_service - INFO - Login response status: 200
2025-09-02T09:13:30.533139683Z 2025-09-02 09:13:30,532 - backend.services.chinese_payment_service - DEBUG - Login response: {
2025-09-02T09:13:30.533153453Z   "msg": "操作成功",
2025-09-02T09:13:30.533158363Z   "code": 200,
2025-09-02T09:13:30.533162743Z   "data": {
2025-09-02T09:13:30.533167573Z     "id": "MEA102507030002",
2025-09-02T09:13:30.533172673Z     "account": "taharizvi.ai@gmail.com",
2025-09-02T09:13:30.533177813Z     "token": "eyJhbGciOiJIUzUxMiJ9.eyJtb2JpbGVTaGVsbF9sb2dpbl91c2VyX2tleToiOiJ0YWhhcml6dmkuYWlAZ21haWwuY29tIn0.jUNZ4VRJJ1eCpwGckFoI9SlP3yXabvWx5Zy29rQWC7mcAPgXg2mH53zOj-fHExapih5mvRtBwJPsUIK2IX_zsg"
2025-09-02T09:13:30.533198574Z   }
2025-09-02T09:13:30.533205914Z }
2025-09-02T09:13:30.533211074Z 2025-09-02 09:13:30,532 - backend.services.chinese_payment_service - INFO - Login successful! Token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:13:30.533216074Z 2025-09-02 09:13:30,532 - backend.services.chinese_payment_service - DEBUG - Signature string: mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:13:30.533220904Z 2025-09-02 09:13:30,532 - backend.services.chinese_payment_service - DEBUG - Generated signature: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:13:30.764514422Z 2025-09-02 09:13:30,764 - backend.services.chinese_payment_service - INFO - Brand list response status: 200
2025-09-02T09:13:30.764530233Z 2025-09-02 09:13:30,764 - backend.services.chinese_payment_service - DEBUG - Brand list response: {
2025-09-02T09:13:30.764535503Z   "msg": "操作成功",
2025-09-02T09:13:30.764540083Z   "code": 200,
2025-09-02T09:13:30.764545013Z   "data": [
2025-09-02T09:13:30.764549073Z     {
2025-09-02T09:13:30.764554383Z       "e_name": "测试品牌",
2025-09-02T09:13:30.764558753Z       "name": "测试品牌",
2025-09-02T09:13:30.764562853Z       "id": "BR102507260001"
2025-09-02T09:13:30.764567013Z     },
2025-09-02T09:13:30.764571344Z     {
2025-09-02T09:13:30.764575573Z       "e_name": "jiuyun",
2025-09-02T09:13:30.764579964Z       "name": "玖云",
2025-09-02T09:13:30.764584624Z       "id": "BR102508200001"
2025-09-02T09:13:30.764588844Z     },
2025-09-02T09:13:30.764593254Z     {
2025-09-02T09:13:30.764597654Z       "e_name": "Apple",
2025-09-02T09:13:30.764602054Z       "name": "苹果",
2025-09-02T09:13:30.764606304Z       "id": "BR20250111000002"
2025-09-02T09:13:30.764622194Z     },
2025-09-02T09:13:30.764625085Z     {
2025-09-02T09:13:30.764627865Z       "e_name": "SAMSUNG",
2025-09-02T09:13:30.764630605Z       "name": "三星",
2025-09-02T09:13:30.764633375Z       "id": "BR020250120000001"
2025-09-02T09:13:30.764636235Z     },
2025-09-02T09:13:30.764638955Z     {
2025-09-02T09:13:30.764641585Z       "e_name": "HUAWEI",
2025-09-02T09:13:30.764644205Z       "name": "华为",
2025-09-02T09:13:30.764647045Z       "id": "BR102504010001"
2025-09-02T09:13:30.764649815Z     },
2025-09-02T09:13:30.764652845Z     {
2025-09-02T09:13:30.764655895Z       "e_name": "Redmi",
2025-09-02T09:13:30.764658965Z       "name": "红米",
2025-09-02T09:13:30.764662045Z       "id": "BR102504060001"
2025-09-02T09:13:30.764665225Z     },
2025-09-02T09:13:30.764667665Z     {
2025-09-02T09:13:30Z clientIP="223.160.225.168" requestID="e23acd71-c9e8-4e20" responseTimeMS=773 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:30Z clientIP="223.160.225.168" requestID="155d110c-0607-4ca8" responseTimeMS=758 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:30Z clientIP="113.68.252.164" requestID="54407bb6-44df-4420" responseTimeMS=62418 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:30.764670535Z       "e_name": "OPPO",
2025-09-02T09:13:30.764673155Z       "name": "OPPO",
2025-09-02T09:13:30.764675695Z       "id": "BR102504020001"
2025-09-02T09:13:30.764678126Z     },
2025-09-02T09:13:30.764680396Z     {
2025-09-02T09:13:30.764683106Z       "e_name": "VIVO",
2025-09-02T09:13:30.764686046Z       "name": "VIVO",
2025-09-02T09:13:30.764688676Z       "id": "BR102504020002"
2025-09-02T09:13:30.764691546Z     },
2025-09-02T09:13:30.764694316Z     {
2025-09-02T09:13:30.764697106Z       "e_name": "Xiaomi",
2025-09-02T09:13:30.764699966Z       "name": "小米",
2025-09-02T09:13:30.764703176Z       "id": "BR20250111000001"
2025-09-02T09:13:30.764705836Z     },
2025-09-02T09:13:30.764708906Z     {
2025-09-02T09:13:30.764711816Z       "e_name": "HONOR",
2025-09-02T09:13:30.764714666Z       "name": "荣耀",
2025-09-02T09:13:30.764717396Z       "id": "BR102504070001"
2025-09-02T09:13:30.764720247Z     }
2025-09-02T09:13:30.764725787Z   ]
2025-09-02T09:13:30.764728456Z }
2025-09-02T09:13:30.764739397Z 2025-09-02 09:13:30,764 - backend.services.chinese_payment_service - INFO - Successfully fetched 10 brands
2025-09-02T09:13:30.764958741Z 2025-09-02 09:13:30,764 - backend.services.chinese_payment_service - INFO - Cache SET for brand_list
2025-09-02T09:13:30.765968921Z Starting get_brands API call
2025-09-02T09:13:30.765980321Z Device ID received: 1517Y7PU1RF3
2025-09-02T09:13:30.765983731Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:13:30.765987091Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_022141_B536F26B/register-user HTTP/1.1" 200 OK
2025-09-02T09:13:30.768592472Z INFO:     113.68.252.164:0 - "GET /api/brands?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:13:30.769356487Z 2025-09-02 09:13:30,769 - backend.services.chinese_payment_service - INFO - Cache HIT for brand_list
2025-09-02T09:13:30.770088901Z Starting get_brands API call
2025-09-02T09:13:30.770094312Z Device ID received: 1517Y7PU1RF3
2025-09-02T09:13:30.770097441Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:13:30.770100512Z INFO:     223.160.225.168:0 - "GET /api/brands?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:13:32Z clientIP="223.160.225.168" requestID="51eaad3b-8476-4ee4" responseTimeMS=1330 responseBytes=611 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:32.654884141Z Generated signature for params {'account': 'taharizvi.ai@gmail.com', 'password': 'EN112233'}: a22664d06749e18629f68935d2a63755
2025-09-02T09:13:32.654899391Z Chinese API response for user/login: {'msg': '操作成功', 'code': 200, 'data': {'id': 'MEA102507030002', 'account': 'taharizvi.ai@gmail.com', 'token': 'eyJhbGciOiJIUzUxMiJ9.eyJtb2JpbGVTaGVsbF9sb2dpbl91c2VyX2tleToiOiJ0YWhhcml6dmkuYWlAZ21haWwuY29tIn0.jUNZ4VRJJ1eCpwGckFoI9SlP3yXabvWx5Zy29rQWC7mcAPgXg2mH53zOj-fHExapih5mvRtBwJPsUIK2IX_zsg'}}
2025-09-02T09:13:32.654905171Z Chinese API login successful, token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:13:32.654916552Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:13:32.654920892Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:13:32.654925261Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR20250111000002'}: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:13:32.654928482Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': [{'mobile_shell_id': 'MS102503280001', 'mobile_model_name': 'iPhone 16', 'width': '74.42', 'stock': 4, 'mobile_model_id': 'MM020250221000006', 'height': '150.96'}, {'mobile_shell_id': 'MS102503270001', 'mobile_model_name': 'iPhone 15', 'width': '76.28', 'stock': 7, 'mobile_model_id': 'MM020250224000008', 'height': '151.72'}, {'mobile_shell_id': 'MS102503280004', 'mobile_model_name': 'iPhone 16 Pro Max', 'width': '80.52', 'stock': 6, 'mobile_model_id': 'MM1020250226000002', 'height': '166.03'}]}
2025-09-02T09:13:32.654931732Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:13:32.654934462Z Session ID: 1517Y7PU1RF3_20250902_022141_B536F26B
2025-09-02T09:13:32.654937242Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_022141_B536F26B', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:13:32.654940502Z INFO:     223.160.225.168:0 - "GET /api/brands/iphone/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:13:32.680178025Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_022141_B536F26B/register-user HTTP/1.1" 410 Gone
2025-09-02T09:13:33.164552707Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/create-session HTTP/1.1" 200 OK
2025-09-02T09:13:32Z clientIP="223.160.225.168" requestID="14fab3f0-aeec-4067" responseTimeMS=1061 responseBytes=383 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:33Z clientIP="223.160.225.168" requestID="69126845-6b16-496d" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:33Z clientIP="223.160.225.168" requestID="abbcefc9-587c-44e9" responseTimeMS=411 responseBytes=439 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:33.868156232Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:13:33.868220714Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:13:33.868229544Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR020250120000001'}: eb5f4a668fee97b77dad3b69ed5cf098
2025-09-02T09:13:33.868234604Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': []}
2025-09-02T09:13:33.868239644Z INFO:     223.160.225.168:0 - "GET /api/brands/samsung/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:13:34Z clientIP="223.160.225.168" requestID="098e8f1e-7cec-4642" responseTimeMS=422 responseBytes=569 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:34Z clientIP="223.160.225.168" requestID="4ff08780-03e4-4865" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:34.364094251Z === CREATE VENDING SESSION START ===
2025-09-02T09:13:34.364126141Z Request: {'machine_id': '1517Y7PU1RF3', 'location': 'Test Location', 'session_timeout_minutes': 30, 'metadata': {'source': 'test_qr_link'}}
2025-09-02T09:13:34.364129911Z Machine ID: 1517Y7PU1RF3
2025-09-02T09:13:34.364132301Z Location: Test Location
2025-09-02T09:13:34.364135142Z Cleaned up 1 expired sessions for machine 1517Y7PU1RF3, session count: 0 -> 0
2025-09-02T09:13:34.364137531Z Successfully created vending session:
2025-09-02T09:13:34.364140471Z - Session ID: 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:13:34.364142771Z - Machine: Chinese Vending Machine 1517Y7PU1RF3 (1517Y7PU1RF3)
2025-09-02T09:13:34.364145032Z - QR URL: https://pimpmycase.shop/?qr=true&machine_id=1517Y7PU1RF3&session_id=1517Y7PU1RF3_20250902_091334_2EFD5861&location=Test%20Location
2025-09-02T09:13:34.364147432Z === CREATE VENDING SESSION END ===
2025-09-02T09:13:34.364149832Z INFO:     223.160.225.168:0 - "POST /api/vending/create-session HTTP/1.1" 200 OK
2025-09-02T09:13:34.840054149Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/register-user HTTP/1.1" 200 OK
2025-09-02T09:13:35Z clientIP="223.160.225.168" requestID="5c536470-69b0-4dd4" responseTimeMS=245 responseBytes=511 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:13:35.568319326Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:13:35.568334626Z Session ID: 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:13:35.568338946Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_091334_2EFD5861', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:13:35.568341046Z Successfully registered user with session:
2025-09-02T09:13:35.568342966Z - Session ID: 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:13:35.568345246Z - Machine: 1517Y7PU1RF3
2025-09-02T09:13:35.568347916Z - User Progress: qr_scanned
2025-09-02T09:13:35.568349596Z === REGISTER USER WITH SESSION END ===
2025-09-02T09:13:35.568351926Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/register-user HTTP/1.1" 200 OK
2025-09-02T09:14:27Z clientIP="223.160.225.168" requestID="07e0d283-cf49-47b0" responseTimeMS=1246 responseBytes=550 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:27.326330304Z 2025-09-02 09:14:27,326 - backend.services.file_service - INFO - Generated end_user token for order-session_1756804467-final-1756804467-d9621e7c.png with 1h expiry
2025-09-02T09:14:27.326457106Z 2025-09-02 09:14:27,326 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804467-final-1756804467-d9621e7c.png, partner: end_user
2025-09-02T09:14:27.327029088Z 🔄 API - Upload final image request received
2025-09-02T09:14:27.327042438Z 🔄 API - template_id: classic
2025-09-02T09:14:27.327047708Z 🔄 API - order_id: None
2025-09-02T09:14:27.327052948Z 🔄 API - metadata: {"inputText":"","selectedFont":"Arial","fontSize":30,"selectedTextColor":"#ffffff","selectedBackgroundColor":"#ffffff","textPosition":{"x":50,"y":50},"uploadTimestamp":"2025-09-02T09:14:20.647Z"}
2025-09-02T09:14:27.327057558Z 🔄 API - final_image_data length: 3637102 chars
2025-09-02T09:14:27.327062238Z ✅ Image saved: order-session_1756804467-final-1756804467-d9621e7c.png (2727809 bytes)
2025-09-02T09:14:27.327066189Z 🔄 API - Final image saved: order-session_1756804467-final-1756804467-d9621e7c.png
2025-09-02T09:14:27.327071029Z 🔄 API - Public URL: https://pimpmycase.onrender.com/image/order-session_1756804467-final-1756804467-d9621e7c.png?token=1756808067:end_user:dcf6f76d9d33fdfeb9018c9906c5a25c1be2c74b8b650cead6cfe56ac35f86ee
2025-09-02T09:14:27.327076059Z INFO:     223.160.225.168:0 - "POST /api/images/upload-final HTTP/1.1" 200 OK
2025-09-02T09:14:27.859593584Z 2025-09-02 09:14:27,859 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804467-final-1756804467-d9621e7c.png, partner: end_user, time remaining: 3600s
2025-09-02T09:14:27.859815128Z 2025-09-02 09:14:27,859 - api_routes - INFO - Image access granted for: order-session_1756804467-final-1756804467-d9621e7c.png from IP: 223.160.225.168, partner: end_user, time remaining: 3600s
2025-09-02T09:14:27.860242617Z INFO:     223.160.225.168:0 - "GET /image/order-session_1756804467-final-1756804467-d9621e7c.png?token=1756808067:end_user:dcf6f76d9d33fdfeb9018c9906c5a25c1be2c74b8b650cead6cfe56ac35f86ee HTTP/1.1" 200 OK
2025-09-02T09:14:28Z clientIP="223.160.225.168" requestID="189e5750-5538-46a7" responseTimeMS=868 responseBytes=2728154 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:30Z clientIP="223.160.225.168" requestID="a3890b58-4366-46b8" responseTimeMS=9 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:30.840893769Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/order-summary HTTP/1.1" 200 OK
2025-09-02T09:14:37Z clientIP="223.160.225.168" requestID="7339daca-fac2-438c" responseTimeMS=272 responseBytes=466 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:37.305786706Z 2025-09-02 09:14:37,305 - backend.services.file_service - INFO - Generated chinese_manufacturing token for order-session_1756804467-final-1756804467-d9621e7c.png with 48h expiry
2025-09-02T09:14:37.305832587Z 2025-09-02 09:14:37,305 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804467-final-1756804467-d9621e7c.png, partner: chinese_manufacturing
2025-09-02T09:14:37.495889631Z DEBUG: Processing final image URL for Chinese API: https://pimpmycase.onrender.com/image/order-session_1756804467-final-1756804467-d9621e7c.png?token=1756808067:end_user:dcf6f76d9d33fdfeb9018c9906c5a25c1be2c74b8b650cead6cfe56ac35f86ee
2025-09-02T09:14:37.495907851Z DEBUG: Extracted clean filename for token generation: order-session_1756804467-final-1756804467-d9621e7c.png
2025-09-02T09:14:37.495912941Z DEBUG: Original URL had tokens: True
2025-09-02T09:14:37.495917391Z ✅ DEBUG: Successfully replaced existing tokens with Chinese manufacturing token
2025-09-02T09:14:37.495922131Z DEBUG: Original URL: https://pimpmycase.onrender.com/image/order-session_1756804467-final-1756804467-d9621e7c.png?token=1756808067:end_user:dcf6f76d9d33fdfeb9018c9906c5a25c1be2c74b8b650cead6cfe56ac35f86ee
2025-09-02T09:14:37.495926311Z DEBUG: New Secure URL: https://pimpmycase.onrender.com/image/order-session_1756804467-final-1756804467-d9621e7c.png?token=1756977277:chinese_manufacturing:6f57cd13df032413a45cc3dd5cc2accd3aad3c2fcee1223f6ba764e6df73ebe9
2025-09-02T09:14:37.495930321Z DEBUG: Token count in new URL: 1
2025-09-02T09:14:37.495934332Z DEBUG: Storing order summary for session 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:37.495940041Z DEBUG: Order data keys: ['designImage', 'imageTransforms', 'price', 'brand', 'brand_id', 'model', 'color', 'chinese_model_id', 'mobile_shell_id', 'device_id', 'template', 'inputText', 'selectedFont', 'selectedTextColor', 'selectedBackgroundColor', 'textPosition', 'paymentMethod', 'finalImagePublicUrl']
2025-09-02T09:14:37.495945222Z DEBUG: Session data keys after update: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:14:37.495949312Z DEBUG: Order summary stored: True
2025-09-02T09:14:37.495954172Z DEBUG: Successfully verified order_summary in database for session 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:37.495959982Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/order-summary HTTP/1.1" 200 OK
2025-09-02T09:14:38Z clientIP="223.160.225.168" requestID="6f490ada-7846-4d6d" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:38.085532723Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/init-payment HTTP/1.1" 200 OK
2025-09-02T09:14:38.773026687Z 2025-09-02 09:14:38,772 - backend.services.chinese_payment_service - INFO - Fetching stock list from Chinese API (cache miss) - device_id: 1517Y7PU1RF3, brand_id: BR20250111000002
2025-09-02T09:14:38.773331393Z 2025-09-02 09:14:38,773 - backend.services.chinese_payment_service - DEBUG - Signature string: BR202501110000021517Y7PU1RF3mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:14:38.773487726Z 2025-09-02 09:14:38,773 - backend.services.chinese_payment_service - DEBUG - Generated signature: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:14:39.223646612Z 2025-09-02 09:14:39,223 - backend.services.chinese_payment_service - INFO - Stock list response status: 200
2025-09-02T09:14:39.223806605Z 2025-09-02 09:14:39,223 - backend.services.chinese_payment_service - DEBUG - Stock list response: {
2025-09-02T09:14:39.223812906Z   "msg": "操作成功",
2025-09-02T09:14:39.223816156Z   "code": 200,
2025-09-02T09:14:39.223819186Z   "data": [
2025-09-02T09:14:39.223822186Z     {
2025-09-02T09:14:39.223825656Z       "mobile_shell_id": "MS102503280001",
2025-09-02T09:14:39.223828386Z       "mobile_model_name": "iPhone 16",
2025-09-02T09:14:39.223831346Z       "width": "74.42",
2025-09-02T09:14:39.223834236Z       "stock": 4,
2025-09-02T09:14:39.223837176Z       "mobile_model_id": "MM020250221000006",
2025-09-02T09:14:39.223840026Z       "height": "150.96"
2025-09-02T09:14:39.223842596Z     },
2025-09-02T09:14:39.223845536Z     {
2025-09-02T09:14:39.223848096Z       "mobile_shell_id": "MS102503270001",
2025-09-02T09:14:39.223850906Z       "mobile_model_name": "iPhone 15",
2025-09-02T09:14:39.223853717Z       "width": "76.28",
2025-09-02T09:14:39.223856397Z       "stock": 7,
2025-09-02T09:14:39.223858866Z       "mobile_model_id": "MM020250224000008",
2025-09-02T09:14:39.223861777Z       "height": "151.72"
2025-09-02T09:14:39.223864517Z     },
2025-09-02T09:14:39.223867117Z     {
2025-09-02T09:14:39.223869667Z       "mobile_shell_id": "MS102503280004",
2025-09-02T09:14:39.223872277Z       "mobile_model_name": "iPhone 16 Pro Max",
2025-09-02T09:14:39.223875157Z       "width": "80.52",
2025-09-02T09:14:39.223877997Z       "stock": 6,
2025-09-02T09:14:39.223880817Z       "mobile_model_id": "MM1020250226000002",
2025-09-02T09:14:39.223883377Z       "height": "166.03"
2025-09-02T09:14:39.223886287Z     }
2025-09-02T09:14:39.223889147Z   ]
2025-09-02T09:14:39.223891787Z }
2025-09-02T09:14:39.223909927Z 2025-09-02 09:14:39,223 - backend.services.chinese_payment_service - INFO - Successfully fetched 3 stock items for brand BR20250111000002
2025-09-02T09:14:39.223921588Z 2025-09-02 09:14:39,223 - backend.services.chinese_payment_service - INFO - Cache SET for stock_1517Y7PU1RF3_BR20250111000002
2025-09-02T09:14:39.224332356Z 2025-09-02 09:14:39,224 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST START (BACKEND_1756804479) ===
2025-09-02T09:14:39.224397337Z 2025-09-02 09:14:39,224 - backend.routes.chinese_api - INFO - Client IP: 127.0.0.1
2025-09-02T09:14:39.224502059Z 2025-09-02 09:14:39,224 - backend.routes.chinese_api - INFO - Request payload: {'mobile_model_id': 'MM020250221000006', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902804479', 'pay_amount': 19.99, 'pay_type': 5}
2025-09-02T09:14:39.22455326Z 2025-09-02 09:14:39,224 - backend.routes.chinese_api - INFO - Timestamp: 2025-09-02T09:14:39.224481+00:00
2025-09-02T09:14:39.253614028Z 2025-09-02 09:14:39,253 - backend.routes.chinese_api - WARNING - Mobile model MM020250221000006 not found in database, proceeding anyway
2025-09-02T09:14:39.25374017Z 2025-09-02 09:14:39,253 - backend.routes.chinese_api - INFO - Payment record: {
2025-09-02T09:14:39.253746501Z   "correlation_id": "BACKEND_1756804479",
2025-09-02T09:14:39.253749141Z   "third_id": "PYEN250902804479",
2025-09-02T09:14:39.253751691Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:14:39.253753851Z   "mobile_model_id": "MM020250221000006",
2025-09-02T09:14:39.253756701Z   "pay_amount": 19.99,
2025-09-02T09:14:39.253759011Z   "pay_type": 5,
2025-09-02T09:14:39.253768841Z   "initiated_at": "2025-09-02T09:14:39.253580+00:00",
2025-09-02T09:14:39.253771381Z   "client_ip": "127.0.0.1"
2025-09-02T09:14:39.253773561Z }
2025-09-02T09:14:39.253779921Z 2025-09-02 09:14:39,253 - backend.routes.chinese_api - INFO - Calling Chinese payment service...
2025-09-02T09:14:39.253857683Z 2025-09-02 09:14:39,253 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE START ===
2025-09-02T09:14:39.253913584Z 2025-09-02 09:14:39,253 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:14:39.253991245Z 2025-09-02 09:14:39,253 - backend.services.chinese_payment_service - INFO - Payment details: third_id=PYEN250902804479, amount=19.99, pay_type=5
2025-09-02T09:14:39.254011386Z 2025-09-02 09:14:39,253 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM020250221000006
2025-09-02T09:14:39.254080257Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Device ID: 1517Y7PU1RF3
2025-09-02T09:14:39.254162319Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:14:39.25423337Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Authentication successful in 0.00s, token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:14:39.254306401Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - === PAYLOAD TO CHINESE API ===
2025-09-02T09:14:39.254392013Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:14:39.254397623Z   "mobile_model_id": "MM020250221000006",
2025-09-02T09:14:39.254400863Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:14:39.254403603Z   "third_id": "PYEN250902804479",
2025-09-02T09:14:39.254406703Z   "pay_amount": 19.99,
2025-09-02T09:14:39.254409394Z   "pay_type": 5
2025-09-02T09:14:39.254412194Z }
2025-09-02T09:14:39.254439994Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Generating signature...
2025-09-02T09:14:39.254581177Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM02025022100000619.995PYEN250902804479mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:14:39.254669439Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - DEBUG - Generated signature: a525fe70f8f24bc1852a7866927c31f9
2025-09-02T09:14:39.25473696Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Signature generated in 0.000s: a525fe70f8f24bc1852a7866927c31f9
2025-09-02T09:14:39.254811501Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - === REQUEST HEADERS ===
2025-09-02T09:14:39.254890503Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Headers: {
2025-09-02T09:14:39.254894403Z   "Authorization": "eyJhbGciOiJIUzUxMiJ9...",
2025-09-02T09:14:39.254896703Z   "sign": "a525fe70f8f24bc1852a7866927c31f9",
2025-09-02T09:14:39.254898883Z   "req_source": "en",
2025-09-02T09:14:39.254901123Z   "Content-Type": "application/json",
2025-09-02T09:14:39.254903223Z   "User-Agent": "PimpMyCase-API/2.0.0"
2025-09-02T09:14:39.254905233Z }
2025-09-02T09:14:39.254944784Z 2025-09-02 09:14:39,254 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:14:39.525654514Z 2025-09-02 09:14:39,525 - backend.services.chinese_payment_service - INFO - HTTP request completed in 0.27s
2025-09-02T09:14:39.525738425Z 2025-09-02 09:14:39,525 - backend.services.chinese_payment_service - INFO - === CHINESE API HTTP RESPONSE ===
2025-09-02T09:14:39.525761846Z 2025-09-02 09:14:39,525 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:14:39.52596103Z 2025-09-02 09:14:39,525 - backend.services.chinese_payment_service - INFO - Response headers: {'Vary': 'Origin, Access-Control-Request-Method, Access-Control-Request-Headers', 'tlogTraceId': '/mobileShell/en/order/payData20250902171439371ramw9w0n', 'X-Content-Type-Options': 'nosniff', 'X-XSS-Protection': '1; mode=block', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': '0', 'Content-Type': 'application/json;charset=UTF-8', 'Transfer-Encoding': 'chunked', 'Date': 'Tue, 02 Sep 2025 09:14:39 GMT', 'Keep-Alive': 'timeout=60', 'Connection': 'keep-alive'}
2025-09-02T09:14:39.526110073Z 2025-09-02 09:14:39,525 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:14:39.526117273Z   "msg": "操作成功",
2025-09-02T09:14:39.526121143Z   "code": 200,
2025-09-02T09:14:39.526124773Z   "data": {
2025-09-02T09:14:39.526129203Z     "id": "MSPY10250902000004",
2025-09-02T09:14:39.526133393Z     "third_id": "PYEN250902804479"
2025-09-02T09:14:39.526136653Z   }
2025-09-02T09:14:39.526140133Z }
2025-09-02T09:14:39.526210725Z 2025-09-02 09:14:39,526 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment data sent successfully!
2025-09-02T09:14:39.526355957Z 2025-09-02 09:14:39,526 - backend.services.chinese_payment_service - INFO - Chinese Payment ID: MSPY10250902000004
2025-09-02T09:14:39.526430689Z 2025-09-02 09:14:39,526 - backend.services.chinese_payment_service - INFO - Third ID: PYEN250902804479
2025-09-02T09:14:39.526573642Z 2025-09-02 09:14:39,526 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE END (SUCCESS) ===
2025-09-02T09:14:39.526579652Z 2025-09-02 09:14:39,526 - backend.routes.chinese_api - INFO - Chinese API call completed in 0.27s
2025-09-02T09:14:39.526666303Z 2025-09-02 09:14:39,526 - backend.routes.chinese_api - INFO - === CHINESE API RESPONSE (BACKEND_1756804479) ===
2025-09-02T09:14:39.526779916Z 2025-09-02 09:14:39,526 - backend.routes.chinese_api - INFO - Response: {
2025-09-02T09:14:39.526785526Z   "msg": "操作成功",
2025-09-02T09:14:39.526787826Z   "code": 200,
2025-09-02T09:14:39.526789976Z   "data": {
2025-09-02T09:14:39.526792456Z     "id": "MSPY10250902000004",
2025-09-02T09:14:39.526795116Z     "third_id": "PYEN250902804479"
2025-09-02T09:14:39.526797426Z   }
2025-09-02T09:14:39.526799516Z }
2025-09-02T09:14:39.526805646Z 2025-09-02 09:14:39,526 - backend.routes.chinese_api - INFO - SUCCESS: Payment data sent successfully to Chinese API
2025-09-02T09:14:39.526944709Z 2025-09-02 09:14:39,526 - backend.routes.chinese_api - INFO - Chinese Payment ID: MSPY10250902000004
2025-09-02T09:14:39.581159428Z 2025-09-02 09:14:39,580 - backend.routes.chinese_api - INFO - Stored payment mapping in PaymentMapping table: PYEN250902804479 -> MSPY10250902000004
2025-09-02T09:14:39.581346852Z 2025-09-02 09:14:39,581 - backend.routes.chinese_api - INFO - Mapped payment third_id PYEN250902804479 -> Chinese payment id MSPY10250902000004
2025-09-02T09:14:39.581461744Z 2025-09-02 09:14:39,581 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST END (BACKEND_1756804479) ===
2025-09-02T09:14:39.668513446Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Adding payment data for third_id PYEN250902804479
2025-09-02T09:14:39.668528936Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Updating session_data for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.668538556Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO -    - Updates: ['payment_data', 'chinese_third_id']
2025-09-02T09:14:39.668716759Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO -    - Merge strategy: update
2025-09-02T09:14:39.668798261Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO - 🔄 Attempt 1/3: Storing session_data
2025-09-02T09:14:39.668943664Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO -    - Original keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:14:39.668948524Z 2025-09-02 09:14:39,668 - backend.utils.session_data_manager - INFO -    - New keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id']
2025-09-02T09:14:39.669156588Z 2025-09-02 09:14:39,669 - backend.utils.session_data_manager - INFO -    - SQLAlchemy dirty objects: 1
2025-09-02T09:14:39.669234209Z 2025-09-02 09:14:39,669 - backend.utils.session_data_manager - INFO -    - Session object in dirty set: True
2025-09-02T09:14:39.723959579Z 2025-09-02 09:14:39,723 - backend.utils.session_data_manager - INFO - ✅ Session data committed successfully
2025-09-02T09:14:39.81665867Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO - ✅ Verification: All expected data found in database for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.816684001Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO - ✅ SessionDataManager: Persistence verified for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.816771543Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Updating session_data for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.816833664Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO -    - Updates: ['chinese_payment_id', 'chinese_response']
2025-09-02T09:14:39.816847824Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO -    - Merge strategy: update
2025-09-02T09:14:39.816933196Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO - 🔄 Attempt 1/3: Storing session_data
2025-09-02T09:14:39.816971067Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO -    - Original keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id']
2025-09-02T09:14:39.817076149Z 2025-09-02 09:14:39,816 - backend.utils.session_data_manager - INFO -    - New keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response']
2025-09-02T09:14:39.817256522Z 2025-09-02 09:14:39,817 - backend.utils.session_data_manager - INFO -    - SQLAlchemy dirty objects: 1
2025-09-02T09:14:39.817326423Z 2025-09-02 09:14:39,817 - backend.utils.session_data_manager - INFO -    - Session object in dirty set: True
2025-09-02T09:14:39.872979641Z 2025-09-02 09:14:39,872 - backend.utils.session_data_manager - INFO - ✅ Session data committed successfully
2025-09-02T09:14:39Z clientIP="223.160.225.168" requestID="1e9c0414-f9a7-4c1b" responseTimeMS=1286 responseBytes=601 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:39.949935985Z 2025-09-02 09:14:39,949 - backend.utils.session_data_manager - INFO - ✅ Verification: All expected data found in database for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.950032497Z 2025-09-02 09:14:39,949 - backend.utils.session_data_manager - INFO - ✅ SessionDataManager: Persistence verified for 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.980691206Z 🔍 DEBUG - Extracted order details:
2025-09-02T09:14:39.980707286Z   - brand_name: 'iphone'
2025-09-02T09:14:39.980857639Z   - brand_id: 'BR20250111000002'
2025-09-02T09:14:39.980863109Z   - model_name: 'iPhone 16'
2025-09-02T09:14:39.980867329Z   - Available order_summary keys: ['designImage', 'imageTransforms', 'price', 'brand', 'brand_id', 'model', 'color', 'chinese_model_id', 'mobile_shell_id', 'device_id', 'template', 'inputText', 'selectedFont', 'selectedTextColor', 'selectedBackgroundColor', 'textPosition', 'paymentMethod', 'finalImagePublicUrl']
2025-09-02T09:14:39.980870329Z 🚀 Calling get_chinese_stock with:
2025-09-02T09:14:39.980872979Z   - device_id (machine_id): '1517Y7PU1RF3'
2025-09-02T09:14:39.980875359Z   - brand_id: 'BR20250111000002'
2025-09-02T09:14:39.980877809Z 📦 Stock validation result: True, items: 3
2025-09-02T09:14:39.980880949Z ✅ Stock validated: iPhone 16 (ID: MM020250221000006, Shell: MS102503280001) has 4 units
2025-09-02T09:14:39.98088389Z Backend - Generated third_id (UTC): PYEN250902804479
2025-09-02T09:14:39.98088671Z ✅ PayData successful, now calling orderData immediately...
2025-09-02T09:14:39.980889179Z ✅ PayData successful for vending machine payment
2025-09-02T09:14:39.980891939Z 💳 Payment initialized with Chinese payment ID: MSPY10250902000004
2025-09-02T09:14:39.98089435Z 🔄 Vending machine will now process physical payment...
2025-09-02T09:14:39.9808968Z 📱 User should complete payment on vending machine
2025-09-02T09:14:39.98089927Z ⏳ System will receive payStatus webhook when payment confirmed
2025-09-02T09:14:39.98090174Z 🔍 DEBUG - BEFORE using SessionDataManager:
2025-09-02T09:14:39.98090406Z   - session_id: 1517Y7PU1RF3_20250902_091334_2EFD5861
2025-09-02T09:14:39.98090767Z   - existing session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:14:39.98091017Z   - session status: active
2025-09-02T09:14:39.98091269Z   - third_id to store: PYEN250902804479
2025-09-02T09:14:39.98091498Z 🔄 Using SessionDataManager to store payment data...
2025-09-02T09:14:39.98091743Z ✅ CRITICAL SUCCESS: Payment data stored using SessionDataManager!
2025-09-02T09:14:39.98091987Z    - third_id: PYEN250902804479
2025-09-02T09:14:39.98092225Z    - Payment data persistence: ✅ VERIFIED
2025-09-02T09:14:39.98092491Z    - Additional data persistence: ✅ VERIFIED
2025-09-02T09:14:39.98092803Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/init-payment HTTP/1.1" 200 OK
2025-09-02T09:14:40Z clientIP="223.160.225.168" requestID="03c53556-2d5d-44fe" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:40.494516536Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091334_2EFD5861/status HTTP/1.1" 200 OK
2025-09-02T09:14:41Z clientIP="223.160.225.168" requestID="74a08a95-8b9f-45e2" responseTimeMS=322 responseBytes=1547 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:14:41Z clientIP="223.160.225.168" requestID="3375f073-837c-4342" responseTimeMS=262 responseBytes=1548 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36" Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:53Z clientIP="223.160.225.168" requestID="df7c119f-55b8-4a5f" responseTimeMS=2 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:53.219216701Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_022141_B536F26B/register-user HTTP/1.1" 200 OK
2025-09-02T09:15:53.249301209Z 2025-09-02 09:15:53,249 - backend.services.chinese_payment_service - INFO - Cache HIT for brand_list
2025-09-02T09:15:53.249801849Z Starting get_brands API call
2025-09-02T09:15:53.249810869Z Device ID received: 1517Y7PU1RF3
2025-09-02T09:15:53.249816139Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:15:53.249821469Z INFO:     223.160.225.168:0 - "GET /api/brands?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:15:54Z clientIP="223.160.225.168" requestID="2837291f-b22b-4a97" responseTimeMS=806 responseBytes=611 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:54Z clientIP="223.160.225.168" requestID="3013e2ef-da1e-46a3" responseTimeMS=852 responseBytes=383 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:54.650034839Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:15:54.65005812Z Session ID: 1517Y7PU1RF3_20250902_022141_B536F26B
2025-09-02T09:15:54.65006588Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_022141_B536F26B', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:15:54.6500715Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:15:54.65007776Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:15:54.65008287Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR20250111000002'}: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:15:54.650088331Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': [{'mobile_shell_id': 'MS102503280001', 'mobile_model_name': 'iPhone 16', 'width': '74.42', 'stock': 4, 'mobile_model_id': 'MM020250221000006', 'height': '150.96'}, {'mobile_shell_id': 'MS102503270001', 'mobile_model_name': 'iPhone 15', 'width': '76.28', 'stock': 7, 'mobile_model_id': 'MM020250224000008', 'height': '151.72'}, {'mobile_shell_id': 'MS102503280004', 'mobile_model_name': 'iPhone 16 Pro Max', 'width': '80.52', 'stock': 6, 'mobile_model_id': 'MM1020250226000002', 'height': '166.03'}]}
2025-09-02T09:15:54.650093051Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_022141_B536F26B/register-user HTTP/1.1" 410 Gone
2025-09-02T09:15:54.65058266Z INFO:     223.160.225.168:0 - "GET /api/brands/iphone/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:15:55Z clientIP="223.160.225.168" requestID="198c614b-c65c-4476" responseTimeMS=459 responseBytes=439 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:55Z clientIP="223.160.225.168" requestID="aef1572e-667d-4348" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:55.148567904Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/create-session HTTP/1.1" 200 OK
2025-09-02T09:15:55.904796806Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:15:55.904828817Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:15:55.904833707Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR020250120000001'}: eb5f4a668fee97b77dad3b69ed5cf098
2025-09-02T09:15:55.904836987Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': []}
2025-09-02T09:15:55.904839987Z INFO:     223.160.225.168:0 - "GET /api/brands/samsung/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:15:56Z clientIP="223.160.225.168" requestID="38837b20-a7db-429c" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:56Z clientIP="223.160.225.168" requestID="cec7a6e4-952a-4dec" responseTimeMS=346 responseBytes=569 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:56.257306017Z === CREATE VENDING SESSION START ===
2025-09-02T09:15:56.257332708Z Request: {'machine_id': '1517Y7PU1RF3', 'location': 'Test Location', 'session_timeout_minutes': 30, 'metadata': {'source': 'test_qr_link'}}
2025-09-02T09:15:56.257336478Z Machine ID: 1517Y7PU1RF3
2025-09-02T09:15:56.257340158Z Location: Test Location
2025-09-02T09:15:56.257344418Z Successfully created vending session:
2025-09-02T09:15:56.257348778Z - Session ID: 1517Y7PU1RF3_20250902_091556_B71008CA
2025-09-02T09:15:56.257352648Z - Machine: Chinese Vending Machine 1517Y7PU1RF3 (1517Y7PU1RF3)
2025-09-02T09:15:56.257356338Z - QR URL: https://pimpmycase.shop/?qr=true&machine_id=1517Y7PU1RF3&session_id=1517Y7PU1RF3_20250902_091556_B71008CA&location=Test%20Location
2025-09-02T09:15:56.257359888Z === CREATE VENDING SESSION END ===
2025-09-02T09:15:56.257363828Z INFO:     223.160.225.168:0 - "POST /api/vending/create-session HTTP/1.1" 200 OK
2025-09-02T09:15:56.844269361Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091556_B71008CA/register-user HTTP/1.1" 200 OK
2025-09-02T09:15:57.568917936Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:15:57.568944526Z Session ID: 1517Y7PU1RF3_20250902_091556_B71008CA
2025-09-02T09:15:57.568948926Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_091556_B71008CA', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:15:57.568952007Z Successfully registered user with session:
2025-09-02T09:15:57.568954916Z - Session ID: 1517Y7PU1RF3_20250902_091556_B71008CA
2025-09-02T09:15:57Z clientIP="223.160.225.168" requestID="a4df26b7-c52b-4caf" responseTimeMS=242 responseBytes=510 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:15:57.568958256Z - Machine: 1517Y7PU1RF3
2025-09-02T09:15:57.568961447Z - User Progress: qr_scanned
2025-09-02T09:15:57.568964447Z === REGISTER USER WITH SESSION END ===
2025-09-02T09:15:57.568967757Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091556_B71008CA/register-user HTTP/1.1" 200 OK
2025-09-02T09:16:26Z clientIP="223.160.225.168" requestID="1228b016-94dd-4c1d" responseTimeMS=926 responseBytes=551 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:26Z clientIP="223.160.225.168" requestID="4c48c468-8b41-46e2" responseTimeMS=40 responseBytes=2061242 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:26.122997459Z 2025-09-02 09:16:26,122 - backend.services.file_service - INFO - Generated end_user token for order-session_1756804586-final-1756804586-a977ea6e.png with 1h expiry
2025-09-02T09:16:26.123161652Z 2025-09-02 09:16:26,123 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804586-final-1756804586-a977ea6e.png, partner: end_user
2025-09-02T09:16:26.124048369Z 🔄 API - Upload final image request received
2025-09-02T09:16:26.12405974Z 🔄 API - template_id: classic
2025-09-02T09:16:26.12406285Z 🔄 API - order_id: None
2025-09-02T09:16:26.12406764Z 🔄 API - metadata: {"inputText":"","selectedFont":"Arial","fontSize":30,"selectedTextColor":"#ffffff","selectedBackgroundColor":"#ffffff","textPosition":{"x":50,"y":50},"uploadTimestamp":"2025-09-02T09:16:20.163Z"}
2025-09-02T09:16:26.12407145Z 🔄 API - final_image_data length: 2747886 chars
2025-09-02T09:16:26.12407606Z ✅ Image saved: order-session_1756804586-final-1756804586-a977ea6e.png (2060897 bytes)
2025-09-02T09:16:26.12407867Z 🔄 API - Final image saved: order-session_1756804586-final-1756804586-a977ea6e.png
2025-09-02T09:16:26.12408242Z 🔄 API - Public URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756808186:end_user:d4742628f1b3543f90d472553e0cddc888e0465d9d5adb3b8cc2ec7308190221
2025-09-02T09:16:26.12408588Z INFO:     223.160.225.168:0 - "POST /api/images/upload-final HTTP/1.1" 200 OK
2025-09-02T09:16:26.666989994Z 2025-09-02 09:16:26,666 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804586-final-1756804586-a977ea6e.png, partner: end_user, time remaining: 3600s
2025-09-02T09:16:26.667033995Z 2025-09-02 09:16:26,666 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 223.160.225.168, partner: end_user, time remaining: 3600s
2025-09-02T09:16:26.667623236Z INFO:     223.160.225.168:0 - "GET /image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756808186:end_user:d4742628f1b3543f90d472553e0cddc888e0465d9d5adb3b8cc2ec7308190221 HTTP/1.1" 200 OK
2025-09-02T09:16:28Z clientIP="223.160.225.168" requestID="343bd337-392a-4113" responseTimeMS=4 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:28.877865826Z INFO:     223.160.225.168:0 - "OPTIONS /api/chinese/order/payData HTTP/1.1" 200 OK
2025-09-02T09:16:37.718425952Z 2025-09-02 09:16:37,718 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST START (BACKEND_1756804597) ===
2025-09-02T09:16:37.718456143Z 2025-09-02 09:16:37,718 - backend.routes.chinese_api - INFO - Client IP: 223.160.225.168
2025-09-02T09:16:37.718548875Z 2025-09-02 09:16:37,718 - backend.routes.chinese_api - INFO - Request payload: {'mobile_model_id': 'MM020250224000008', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902218281', 'pay_amount': 19.99, 'pay_type': 12}
2025-09-02T09:16:37.718681847Z 2025-09-02 09:16:37,718 - backend.routes.chinese_api - INFO - Timestamp: 2025-09-02T09:16:37.718583+00:00
2025-09-02T09:16:37.796710912Z 2025-09-02 09:16:37,796 - backend.routes.chinese_api - WARNING - Mobile model MM020250224000008 not found in database, proceeding anyway
2025-09-02T09:16:37.796883026Z 2025-09-02 09:16:37,796 - backend.routes.chinese_api - INFO - Payment record: {
2025-09-02T09:16:37.796892046Z   "correlation_id": "BACKEND_1756804597",
2025-09-02T09:16:37.796894946Z   "third_id": "PYEN250902218281",
2025-09-02T09:16:37.796897586Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:16:37.796899696Z   "mobile_model_id": "MM020250224000008",
2025-09-02T09:16:37.796902326Z   "pay_amount": 19.99,
2025-09-02T09:16:37.796906586Z   "pay_type": 12,
2025-09-02T09:16:37.796910916Z   "initiated_at": "2025-09-02T09:16:37.796664+00:00",
2025-09-02T09:16:37.796914536Z   "client_ip": "223.160.225.168"
2025-09-02T09:16:37.796917827Z }
2025-09-02T09:16:37.796975208Z 2025-09-02 09:16:37,796 - backend.routes.chinese_api - INFO - Calling Chinese payment service...
2025-09-02T09:16:37.797051709Z 2025-09-02 09:16:37,796 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE START ===
2025-09-02T09:16:37.797167761Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:16:37.797179362Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Payment details: third_id=PYEN250902218281, amount=19.99, pay_type=12
2025-09-02T09:16:37.797344915Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM020250224000008
2025-09-02T09:16:37.797391916Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Device ID: 1517Y7PU1RF3
2025-09-02T09:16:37.797476247Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:16:37.797551309Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Authentication successful in 0.00s, token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:16:37.79761579Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - === PAYLOAD TO CHINESE API ===
2025-09-02T09:16:37.797731103Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:16:37.797737023Z   "mobile_model_id": "MM020250224000008",
2025-09-02T09:16:37.797740833Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:16:37.797743253Z   "third_id": "PYEN250902218281",
2025-09-02T09:16:37.797746693Z   "pay_amount": 19.99,
2025-09-02T09:16:37.797749653Z   "pay_type": 12
2025-09-02T09:16:37.797751983Z }
2025-09-02T09:16:37.797829914Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - INFO - Generating signature...
2025-09-02T09:16:37.797885086Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM02025022400000819.9912PYEN250902218281mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:16:37.798035129Z 2025-09-02 09:16:37,797 - backend.services.chinese_payment_service - DEBUG - Generated signature: 13bab5a77933e3dd00e09241164ae00d
2025-09-02T09:16:37.7981101Z 2025-09-02 09:16:37,798 - backend.services.chinese_payment_service - INFO - Signature generated in 0.000s: 13bab5a77933e3dd00e09241164ae00d
2025-09-02T09:16:37.799043158Z 2025-09-02 09:16:37,798 - backend.services.chinese_payment_service - INFO - === REQUEST HEADERS ===
2025-09-02T09:16:37.799056228Z 2025-09-02 09:16:37,798 - backend.services.chinese_payment_service - INFO - Headers: {
2025-09-02T09:16:37.799059209Z   "Authorization": "eyJhbGciOiJIUzUxMiJ9...",
2025-09-02T09:16:37.799061318Z   "sign": "13bab5a77933e3dd00e09241164ae00d",
2025-09-02T09:16:37.799063869Z   "req_source": "en",
2025-09-02T09:16:37.799066218Z   "Content-Type": "application/json",
2025-09-02T09:16:37.799068999Z   "User-Agent": "PimpMyCase-API/2.0.0"
2025-09-02T09:16:37.799071089Z }
2025-09-02T09:16:37.799073809Z 2025-09-02 09:16:37,798 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:16:38.227303721Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - HTTP request completed in 0.43s
2025-09-02T09:16:38.227396873Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - === CHINESE API HTTP RESPONSE ===
2025-09-02T09:16:38.227476434Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:16:38.227590367Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - Response headers: {'Vary': 'Origin, Access-Control-Request-Method, Access-Control-Request-Headers', 'tlogTraceId': '/mobileShell/en/order/payData20250902171638100ke4n65nv', 'X-Content-Type-Options': 'nosniff', 'X-XSS-Protection': '1; mode=block', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': '0', 'Content-Type': 'application/json;charset=UTF-8', 'Transfer-Encoding': 'chunked', 'Date': 'Tue, 02 Sep 2025 09:16:38 GMT', 'Keep-Alive': 'timeout=60', 'Connection': 'keep-alive'}
2025-09-02T09:16:38.22774485Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:16:38.22775099Z   "msg": "操作成功",
2025-09-02T09:16:38.22775383Z   "code": 200,
2025-09-02T09:16:38.22775639Z   "data": {
2025-09-02T09:16:38.22775984Z     "id": "MSPY10250902000005",
2025-09-02T09:16:38.22776315Z     "third_id": "PYEN250902218281"
2025-09-02T09:16:38.22776584Z   }
2025-09-02T09:16:38.2277687Z }
2025-09-02T09:16:38.227818471Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment data sent successfully!
2025-09-02T09:16:38.227915023Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - Chinese Payment ID: MSPY10250902000005
2025-09-02T09:16:38.227974574Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - Third ID: PYEN250902218281
2025-09-02T09:16:38.228072286Z 2025-09-02 09:16:38,227 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE END (SUCCESS) ===
2025-09-02T09:16:38.228154067Z 2025-09-02 09:16:38,228 - backend.routes.chinese_api - INFO - Chinese API call completed in 0.43s
2025-09-02T09:16:38.22825168Z 2025-09-02 09:16:38,228 - backend.routes.chinese_api - INFO - === CHINESE API RESPONSE (BACKEND_1756804597) ===
2025-09-02T09:16:38.228331791Z 2025-09-02 09:16:38,228 - backend.routes.chinese_api - INFO - Response: {
2025-09-02T09:16:38.228336701Z   "msg": "操作成功",
2025-09-02T09:16:38.228339741Z   "code": 200,
2025-09-02T09:16:38.228346171Z   "data": {
2025-09-02T09:16:38.228350022Z     "id": "MSPY10250902000005",
2025-09-02T09:16:38.228352791Z     "third_id": "PYEN250902218281"
2025-09-02T09:16:38.228354542Z   }
2025-09-02T09:16:38.228356331Z }
2025-09-02T09:16:38.228399162Z 2025-09-02 09:16:38,228 - backend.routes.chinese_api - INFO - SUCCESS: Payment data sent successfully to Chinese API
2025-09-02T09:16:38.228459644Z 2025-09-02 09:16:38,228 - backend.routes.chinese_api - INFO - Chinese Payment ID: MSPY10250902000005
2025-09-02T09:16:38.282089252Z 2025-09-02 09:16:38,281 - backend.routes.chinese_api - INFO - Stored payment mapping in PaymentMapping table: PYEN250902218281 -> MSPY10250902000005
2025-09-02T09:16:38.282167684Z 2025-09-02 09:16:38,282 - backend.routes.chinese_api - INFO - Mapped payment third_id PYEN250902218281 -> Chinese payment id MSPY10250902000005
2025-09-02T09:16:38.282239175Z 2025-09-02 09:16:38,282 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST END (BACKEND_1756804597) ===
2025-09-02T09:16:38.282847707Z INFO:     223.160.225.168:0 - "POST /api/chinese/order/payData HTTP/1.1" 200 OK
2025-09-02T09:16:38.795276785Z INFO:     223.160.225.168:0 - "OPTIONS /create-checkout-session HTTP/1.1" 200 OK
2025-09-02T09:16:38Z clientIP="223.160.225.168" requestID="c20d6d9d-1eab-4049" responseTimeMS=569 responseBytes=395 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:38Z clientIP="223.160.225.168" requestID="2de176b4-9d46-4d37" responseTimeMS=2 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:39Z clientIP="223.160.225.168" requestID="4be60050-aba3-4b18" responseTimeMS=556 responseBytes=659 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:16:39.319584146Z 2025-09-02 09:16:39,319 - stripe - INFO - message='Request to Stripe api' method=post path=https://api.stripe.com/v1/checkout/sessions
2025-09-02T09:16:39.815770717Z 2025-09-02 09:16:39,815 - stripe - INFO - message='Stripe API response' path=https://api.stripe.com/v1/checkout/sessions response_code=200
2025-09-02T09:16:39.861367068Z Payment amount: 19.99£ (1999 pence)
2025-09-02T09:16:39.861387079Z INFO:     223.160.225.168:0 - "POST /create-checkout-session HTTP/1.1" 200 OK
2025-09-02T09:16:46Z clientIP="103.213.96.36" requestID="8df28e5d-154c-4444" responseTimeMS=294 responseBytes=458 userAgent="Mozilla/5.0"
2025-09-02T09:16:46Z clientIP="103.213.96.36" requestID="b9c3bf01-2d96-486b" responseTimeMS=121 responseBytes=280 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:16:46.059759334Z === CREATE VENDING SESSION START ===
2025-09-02T09:16:46.059780174Z Request: {'machine_id': '1517Y7PU1RF3', 'location': None, 'session_timeout_minutes': 60, 'metadata': {}}
2025-09-02T09:16:46.059785744Z Machine ID: 1517Y7PU1RF3
2025-09-02T09:16:46.059801755Z Location: None
2025-09-02T09:16:46.059803835Z Successfully created vending session:
2025-09-02T09:16:46.059806025Z - Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:16:46.059807685Z - Machine: Chinese Vending Machine 1517Y7PU1RF3 (1517Y7PU1RF3)
2025-09-02T09:16:46.059810075Z - QR URL: https://pimpmycase.shop/?qr=true&machine_id=1517Y7PU1RF3&session_id=1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:16:46.059811875Z === CREATE VENDING SESSION END ===
2025-09-02T09:16:46.059814025Z INFO:     103.213.96.36:0 - "POST /api/vending/create-session HTTP/1.1" 200 OK
2025-09-02T09:16:46.662874586Z 2025-09-02 09:16:46,662 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:16:46.782159788Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:16:51Z clientIP="103.213.96.36" requestID="c4606bb3-f486-493c" responseTimeMS=113 responseBytes=280 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:16:51.031147022Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:01Z clientIP="103.213.96.36" requestID="7e768e38-4897-4bbf" responseTimeMS=130 responseBytes=280 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:17:01.389284617Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:10Z clientIP="103.213.96.36" requestID="65148842-fcde-4a6d" responseTimeMS=112 responseBytes=280 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:17:10.928060598Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:11Z clientIP="3.130.192.231" requestID="832c15ed-ef3b-42d8" responseTimeMS=3 responseBytes=246 userAgent="Stripe/1.0 (+https://stripe.com/docs/webhooks)"
2025-09-02T09:17:11.98779976Z Stripe webhook received: checkout.session.completed
2025-09-02T09:17:11.987833231Z Payment successful for session: cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd
2025-09-02T09:17:11.987837331Z INFO:     3.130.192.231:0 - "POST /stripe-webhook HTTP/1.1" 200 OK
2025-09-02T09:17:12Z clientIP="3.18.12.63" requestID="0796ea64-aded-43e9" responseTimeMS=3 responseBytes=244 userAgent="Stripe/1.0 (+https://stripe.com/docs/webhooks)"
2025-09-02T09:17:12.053028406Z Stripe webhook received: payment_intent.succeeded
2025-09-02T09:17:12.053051066Z Payment intent succeeded: pi_3S2qKwP7sQmXV4Gu0EuBNgNL
2025-09-02T09:17:12.053053326Z INFO:     3.18.12.63:0 - "POST /stripe-webhook HTTP/1.1" 200 OK
2025-09-02T09:17:18Z clientIP="223.160.225.168" requestID="50de9cad-02b2-4d1a" responseTimeMS=4 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:17:18.682099918Z INFO:     223.160.225.168:0 - "OPTIONS /process-payment-success HTTP/1.1" 200 OK
2025-09-02T09:17:19.156478594Z 2025-09-02 09:17:19,156 - stripe - INFO - message='Request to Stripe api' method=get path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd
2025-09-02T09:17:19.30047775Z 2025-09-02 09:17:19,300 - stripe - INFO - message='Stripe API response' path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd response_code=200
2025-09-02T09:17:19.594281645Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT STATUS NOTIFICATION START ===
2025-09-02T09:17:19.594309036Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payStatus
2025-09-02T09:17:19.594358947Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - Payment status details: third_id=PYEN250902218281, status=3, amount=19.99
2025-09-02T09:17:19.594486419Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:17:19.59450993Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - === PAYMENT STATUS PAYLOAD ===
2025-09-02T09:17:19.594660573Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:17:19.594669653Z   "third_id": "PYEN250902218281",
2025-09-02T09:17:19.594674143Z   "status": 3,
2025-09-02T09:17:19.594679463Z   "pay_amount": 19.99
2025-09-02T09:17:19.594683623Z }
2025-09-02T09:17:19.594717064Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - DEBUG - Signature string: 19.993PYEN250902218281mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:17:19.594831746Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - DEBUG - Generated signature: 64933b17584d804b3c92ee93f8a19024
2025-09-02T09:17:19.594903107Z 2025-09-02 09:17:19,594 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payStatus
2025-09-02T09:17:19.820016699Z 2025-09-02 09:17:19,819 - backend.services.chinese_payment_service - INFO - Payment status request completed in 0.22s
2025-09-02T09:17:19.82004926Z 2025-09-02 09:17:19,819 - backend.services.chinese_payment_service - INFO - === CHINESE API PAYMENT STATUS RESPONSE ===
2025-09-02T09:17:19.820120691Z 2025-09-02 09:17:19,820 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:17:19.820303335Z 2025-09-02 09:17:19,820 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:17:19.820315515Z   "msg": "操作成功",
2025-09-02T09:17:19.820318775Z   "code": 200
2025-09-02T09:17:19.820321425Z }
2025-09-02T09:17:19.820353896Z 2025-09-02 09:17:19,820 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment status sent successfully!
2025-09-02T09:17:19.820433788Z 2025-09-02 09:17:19,820 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT STATUS NOTIFICATION END (SUCCESS) ===
2025-09-02T09:17:19.82058932Z 2025-09-02 09:17:19,820 - backend.services.file_service - INFO - Generated chinese_manufacturing token for order-session_1756804586-final-1756804586-a977ea6e.png with 48h expiry
2025-09-02T09:17:19.852720779Z 2025-09-02 09:17:19,852 - backend.routes.chinese_api - INFO - Found payment mapping in PaymentMapping table: PYEN250902218281 -> MSPY10250902000005
2025-09-02T09:17:19.852809381Z 2025-09-02 09:17:19,852 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION START ===
2025-09-02T09:17:19.852867962Z 2025-09-02 09:17:19,852 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:17:19.852975984Z 2025-09-02 09:17:19,852 - backend.services.chinese_payment_service - INFO - Order details: third_pay_id=PYEN250902218281, third_id=OREN250902804639
2025-09-02T09:17:19.852984384Z 2025-09-02 09:17:19,852 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM020250224000008, device_id: 1517Y7PU1RF3
2025-09-02T09:17:19.853041725Z 2025-09-02 09:17:19,852 - backend.services.chinese_payment_service - INFO - Mobile shell ID: MS102503270001
2025-09-02T09:17:19.853104886Z 2025-09-02 09:17:19,853 - backend.services.chinese_payment_service - INFO - Design image URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817
2025-09-02T09:17:19.853258959Z 2025-09-02 09:17:19,853 - backend.services.chinese_payment_service - INFO - Waiting 3 seconds for Chinese API to process payment before sending order data...
2025-09-02T09:17:22.853591899Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - 3-second delay completed, proceeding with order data submission
2025-09-02T09:17:22.853912305Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - 🔒 PRESERVING authentication tokens in URL for Chinese API access
2025-09-02T09:17:22.853924935Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - Full authenticated URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817
2025-09-02T09:17:22.853929425Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - ✅ URL contains required authentication token
2025-09-02T09:17:22.853939505Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - ✅ Token validation passed: 1 token parameter
2025-09-02T09:17:22.854062128Z 2025-09-02 09:17:22,853 - backend.services.chinese_payment_service - INFO - ✅ Using AUTHENTICATED URL for Chinese API (NOT shortened): https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817
2025-09-02T09:17:22.85416667Z 2025-09-02 09:17:22,854 - backend.services.chinese_payment_service - INFO - === ORDER DATA PAYLOAD ===
2025-09-02T09:17:22.854280252Z 2025-09-02 09:17:22,854 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:17:22.854292742Z   "third_pay_id": "PYEN250902218281",
2025-09-02T09:17:22.854295542Z   "third_id": "OREN250902804639",
2025-09-02T09:17:22.854297952Z   "mobile_model_id": "MM020250224000008",
2025-09-02T09:17:22.854301282Z   "pic": "https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817",
2025-09-02T09:17:22.854304502Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:17:22.854307053Z   "mobile_shell_id": "MS102503270001"
2025-09-02T09:17:22.854309362Z }
2025-09-02T09:17:22.854390814Z 2025-09-02 09:17:22,854 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM020250224000008MS102503270001https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817OREN250902804639PYEN250902218281mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:17:22.854468046Z 2025-09-02 09:17:22,854 - backend.services.chinese_payment_service - DEBUG - Generated signature: 91a468833ede1817acf1b1503248b1c0
2025-09-02T09:17:22.854537077Z 2025-09-02 09:17:22,854 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:17:23.188548728Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - Order data request completed in 0.33s
2025-09-02T09:17:23.18865331Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - === CHINESE API ORDER DATA RESPONSE ===
2025-09-02T09:17:23.188680021Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:17:23.188871345Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:17:23.188878955Z   "msg": "操作成功",
2025-09-02T09:17:23.188881815Z   "code": 200,
2025-09-02T09:17:23.188884125Z   "data": {
2025-09-02T09:17:23.188887085Z     "id": "MSOR10250902000003",
2025-09-02T09:17:23.188889915Z     "third_id": "OREN250902804639",
2025-09-02T09:17:23.188892185Z     "queue_no": "6693",
2025-09-02T09:17:23.188894335Z     "status": 4
2025-09-02T09:17:23.188896445Z   }
2025-09-02T09:17:23Z clientIP="223.160.225.168" requestID="87b05f53-f5d4-4e62" responseTimeMS=4218 responseBytes=501 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:17:23.188898655Z }
2025-09-02T09:17:23.188957076Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - SUCCESS: Order data sent successfully!
2025-09-02T09:17:23.189010127Z 2025-09-02 09:17:23,188 - backend.services.chinese_payment_service - INFO - Chinese Order ID: MSOR10250902000003
2025-09-02T09:17:23.189087069Z 2025-09-02 09:17:23,189 - backend.services.chinese_payment_service - INFO - Queue Number: 6693
2025-09-02T09:17:23.18916675Z 2025-09-02 09:17:23,189 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION END (SUCCESS) ===
2025-09-02T09:17:23.371871203Z Starting payment processing for session: cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd
2025-09-02T09:17:23.371903374Z Checkout session status: paid
2025-09-02T09:17:23.371908784Z Session amount: 1999
2025-09-02T09:17:23.371912504Z Session currency: gbp
2025-09-02T09:17:23.371916674Z === COMPLETE CHINESE API INTEGRATION START for order 45ceecc6-8204-4589-8145-90cea98d091f ===
2025-09-02T09:17:23.371921514Z Payment method: app, has device_id: True, is_vending_payment: True
2025-09-02T09:17:23.371925374Z Payment data validation:
2025-09-02T09:17:23.371929514Z   - existing_third_id: PYEN250902218281
2025-09-02T09:17:23.371934064Z   - existing_chinese_payment_id: MSPY10250902000005
2025-09-02T09:17:23.371937434Z   - device_id: 1517Y7PU1RF3
2025-09-02T09:17:23.371939615Z   - chinese_model_id: MM020250224000008
2025-09-02T09:17:23.371942015Z Chinese API integration: device_id=1517Y7PU1RF3, model_id=MM020250224000008, third_id=PYEN250902218281
2025-09-02T09:17:23.371945104Z STEP 1: Sending payment data to Chinese API...
2025-09-02T09:17:23.371948995Z ✅ Payment data already sent by frontend with third_id: PYEN250902218281
2025-09-02T09:17:23.371952625Z STEP 2: Sending payment status notification to Chinese API...
2025-09-02T09:17:23.371956105Z Chinese API payStatus response: {'msg': '操作成功', 'code': 200}
2025-09-02T09:17:23.371959585Z SUCCESS: Payment status notification sent to Chinese API
2025-09-02T09:17:23.371962725Z STEP 3: Preparing order data for Chinese API...
2025-09-02T09:17:23.371966525Z ✅ Using existing permanent URL from pic field: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756808186:end_user:d4742628f1b3543f90d472553e0cddc888e0465d9d5adb3b8cc2ec7308190221
2025-09-02T09:17:23.371970335Z 🔧 Extracted clean filename: order-session_1756804586-final-1756804586-a977ea6e.png
2025-09-02T09:17:23.371973625Z 🔧 CRITICAL FIX: Generating NEW secure URL with CLEAN filename
2025-09-02T09:17:23.371976715Z    Clean filename: order-session_1756804586-final-1756804586-a977ea6e.png
2025-09-02T09:17:23.371979995Z    Original URL had tokens: True
2025-09-02T09:17:23.371983375Z ✅ Generated CLEAN secure Chinese manufacturing token (48h)
2025-09-02T09:17:23.371988175Z    Original URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756808186:end_user:d4742628f1b3543f90d472553e0cddc888e0465d9d5adb3b8cc2ec7308190221
2025-09-02T09:17:23.371992756Z    New Clean URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817
2025-09-02T09:17:23.371996345Z    Token count: 1 (correct)
2025-09-02T09:17:23.371999746Z Backend - Generated third_id (UTC): OREN250902804639
2025-09-02T09:17:23.372002776Z ✅ Using original third_id for orderData third_pay_id: PYEN250902218281
2025-09-02T09:17:23.372005656Z ℹ️ Chinese internal payment ID (for reference): MSPY10250902000005
2025-09-02T09:17:23.372010476Z DEBUG: Full order_data received: {'pic': 'https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756808186:end_user:d4742628f1b3543f90d472553e0cddc888e0465d9d5adb3b8cc2ec7308190221', 'chinese_model_id': 'MM020250224000008', 'mobile_model_id': 'MM020250224000008', 'mobile_shell_id': 'MS102503270001', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902218281', 'chinese_payment_id': 'MSPY10250902000005'}
2025-09-02T09:17:23.372013656Z ✅ Mobile shell ID extracted: MS102503270001
2025-09-02T09:17:23.372016946Z Sending order data: third_pay_id=PYEN250902218281 (Chinese ID), third_id=OREN250902804639
2025-09-02T09:17:23.372020406Z Original payment ID: PYEN250902218281
2025-09-02T09:17:23.372024036Z Design image URL: https://pimpmycase.onrender.com/image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817
2025-09-02T09:17:23.372033256Z Mobile shell ID: MS102503270001
2025-09-02T09:17:23.372035566Z ✅ Calling Chinese API orderData
2025-09-02T09:17:23.372038836Z Chinese API orderData response: {'msg': '操作成功', 'code': 200, 'data': {'id': 'MSOR10250902000003', 'third_id': 'OREN250902804639', 'queue_no': '6693', 'status': 4}}
2025-09-02T09:17:23.372041057Z SUCCESS: Order data sent to Chinese API for printing
2025-09-02T09:17:23.372043206Z ✅ Using Chinese API queue number: 6693
2025-09-02T09:17:23.372045366Z Successfully completed Chinese API integration
2025-09-02T09:17:23.372047457Z === COMPLETE CHINESE API INTEGRATION END ===
2025-09-02T09:17:23.372049557Z ✅ Final queue number from Chinese API: 6693
2025-09-02T09:17:23.372051717Z INFO:     223.160.225.168:0 - "POST /process-payment-success HTTP/1.1" 200 OK
2025-09-02T09:17:24Z clientIP="113.68.252.164" requestID="91f63f09-5432-4f0e" responseTimeMS=106 responseBytes=2061242 userAgent=""
2025-09-02T09:17:24.564939903Z 2025-09-02 09:17:24,564 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804586-final-1756804586-a977ea6e.png, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:17:24.565005984Z 2025-09-02 09:17:24,564 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:17:24.565488574Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817 HTTP/1.1" 200 OK
2025-09-02T09:17:25Z clientIP="103.213.96.36" requestID="026d9f99-91bb-4ef0" responseTimeMS=108 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:17:25.228104211Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:25.887129318Z 2025-09-02 09:17:25,886 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804586-final-1756804586-a977ea6e.png, partner: chinese_manufacturing, time remaining: 172794s
2025-09-02T09:17:25.887301311Z 2025-09-02 09:17:25,887 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172794s
2025-09-02T09:17:25.887880562Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817 HTTP/1.1" 200 OK
2025-09-02T09:17:26Z clientIP="113.68.252.164" requestID="5998fb70-5dfa-4f69" responseTimeMS=116 responseBytes=2061242 userAgent=""
2025-09-02T09:17:31Z clientIP="103.213.96.36" requestID="60e0de5a-0fee-44af" responseTimeMS=368 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:17:31Z clientIP="103.213.96.36" requestID="99ee3fd7-683c-4f1b" responseTimeMS=357 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:17:31.155393757Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:31.183944395Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:17:41Z clientIP="103.213.96.36" requestID="69d5ad4a-7f9a-4c00" responseTimeMS=128 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:17:41Z clientIP="103.213.96.36" requestID="c837524f-de5a-488d" responseTimeMS=224 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:17:41.221116156Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:17:41.252706013Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:17:50Z clientIP="113.68.252.164" requestID="3e2523ac-dc36-44ba" responseTimeMS=106 responseBytes=2061242 userAgent=""
2025-09-02T09:17:50.226537467Z 2025-09-02 09:17:50,226 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804586-final-1756804586-a977ea6e.png, partner: chinese_manufacturing, time remaining: 172769s
2025-09-02T09:17:50.226609498Z 2025-09-02 09:17:50,226 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172769s
2025-09-02T09:20:02.611370661Z 2025-09-02 09:20:02,611 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172637s
2025-09-02T09:20:02.612022054Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817 HTTP/1.1" 200 OK
2025-09-02T09:20:06Z clientIP="103.213.96.36" requestID="4343ea7e-547c-4571" responseTimeMS=181 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:06Z clientIP="103.213.96.36" requestID="98597930-f44f-43ed" responseTimeMS=185 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:20:06.280674907Z 2025-09-02 09:20:06,280 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:20:06.36667839Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:20:06.394125737Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:20:08Z clientIP="113.68.252.164" requestID="21a34f9c-3803-4861" responseTimeMS=9 responseBytes=2061242 userAgent=""
2025-09-02T09:20:08.656181678Z 2025-09-02 09:20:08,655 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804586-final-1756804586-a977ea6e.png, partner: chinese_manufacturing, time remaining: 172631s
2025-09-02T09:20:08.656235819Z 2025-09-02 09:20:08,655 - api_routes - INFO - Image access granted for: order-session_1756804586-final-1756804586-a977ea6e.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172631s
2025-09-02T09:20:08.656499884Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804586-final-1756804586-a977ea6e.png?token=1756977439:chinese_manufacturing:4cf414a2e12daad762b51404e5cb7e6974d7685c7e8d02b953d609fa43c59817 HTTP/1.1" 200 OK
2025-09-02T09:20:11Z clientIP="103.213.96.36" requestID="72d1e9fe-f399-4ab0" responseTimeMS=134 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:11Z clientIP="103.213.96.36" requestID="028a8ea9-b636-43cf" responseTimeMS=114 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:20:11.081998194Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:20:11.235693141Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:20:21Z clientIP="103.213.96.36" requestID="e1954548-3f5a-402d" responseTimeMS=190 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:20:21Z clientIP="103.213.96.36" requestID="2671c044-57f1-4983" responseTimeMS=210 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:21.259507391Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:20:21.287493329Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:20:30.971994166Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:20:30Z clientIP="103.213.96.36" requestID="146940ce-d1ca-497b" responseTimeMS=173 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:31Z clientIP="103.213.96.36" requestID="657c2010-20ef-449b" responseTimeMS=115 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:20:31.001504594Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:20:46Z clientIP="103.213.96.36" requestID="0880de11-b58f-4029" responseTimeMS=114 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:46.273571033Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:20:48Z clientIP="103.213.96.36" requestID="9d70a91b-c64b-4364" responseTimeMS=118 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:20:48.877169725Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:20:51Z clientIP="103.213.96.36" requestID="c7cbfdfe-c353-438a" responseTimeMS=107 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:20:51.661603156Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:01Z clientIP="103.213.96.36" requestID="4bc21bc4-fd11-4dca" responseTimeMS=188 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:01Z clientIP="103.213.96.36" requestID="498b2d40-bc0f-467e" responseTimeMS=165 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:01.543810343Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:01.573255469Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:21:07Z clientIP="223.160.225.168" requestID="644e2f1f-e988-431f" responseTimeMS=635 responseBytes=423 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:07.005574244Z 2025-09-02 09:21:07,005 - stripe - INFO - message='Request to Stripe api' method=get path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd
2025-09-02T09:21:07.264835838Z 2025-09-02 09:21:07,264 - stripe - INFO - message='Stripe API response' path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd response_code=200
2025-09-02T09:21:07.608343891Z Traceback (most recent call last):
2025-09-02T09:21:07.608373142Z   File "/opt/render/project/src/backend/routes/payment.py", line 497, in process_payment_success
2025-09-02T09:21:07.608378002Z     raise HTTPException(
2025-09-02T09:21:07.608382482Z fastapi.exceptions.HTTPException: 400: Chinese model ID missing for vending payment - please select your phone model again
2025-09-02T09:21:07.60932623Z Traceback (most recent call last):
2025-09-02T09:21:07.609347721Z   File "/opt/render/project/src/backend/routes/payment.py", line 537, in process_payment_success
2025-09-02T09:21:07.609352821Z     raise HTTPException(
2025-09-02T09:21:07.609359651Z fastapi.exceptions.HTTPException: 503: Vending machine payment failed: Chinese API integration required but unavailable. Please try again or contact support.
2025-09-02T09:21:07.637026492Z Starting payment processing for session: cs_test_a1sZ69FAmQeCo4tDjpQSUoFpRR3YCu00LuJT5lFVvN3DuOtLnMcHIQpKWd
2025-09-02T09:21:07.637070623Z Checkout session status: paid
2025-09-02T09:21:07.637075813Z Session amount: 1999
2025-09-02T09:21:07.637079384Z Session currency: gbp
2025-09-02T09:21:07.637083124Z === COMPLETE CHINESE API INTEGRATION START for order 075318d6-7bfc-417f-a3b7-fea1fe335f22 ===
2025-09-02T09:21:07.637086944Z Payment method: app, has device_id: True, is_vending_payment: True
2025-09-02T09:21:07.637104524Z Payment data validation:
2025-09-02T09:21:07.637107194Z   - existing_third_id: None
2025-09-02T09:21:07.637109754Z   - existing_chinese_payment_id: None
2025-09-02T09:21:07.637111924Z   - device_id: 1517Y7PU1RF3
2025-09-02T09:21:07.637114034Z   - chinese_model_id: None
2025-09-02T09:21:07.637116294Z ❌ CRITICAL: Vending payment missing stored payment data - this will cause duplicate payData
2025-09-02T09:21:07.637118694Z Available order_data keys: ['device_id']
2025-09-02T09:21:07.637120934Z ❌ CRITICAL: Vending payment has device_id but missing chinese_model_id - Chinese API integration required
2025-09-02T09:21:07.637123284Z This is likely due to model selection not being persisted properly
2025-09-02T09:21:07.637125994Z CRITICAL: Chinese API integration failed: 400: Chinese model ID missing for vending payment - please select your phone model again
2025-09-02T09:21:07.637128185Z ❌ CRITICAL: Chinese API integration failed - cannot generate queue number without Chinese approval
2025-09-02T09:21:07.637130594Z Payment processing error: 503: Vending machine payment failed: Chinese API integration required but unavailable. Please try again or contact support.
2025-09-02T09:21:07.637132694Z INFO:     223.160.225.168:0 - "POST /process-payment-success HTTP/1.1" 500 Internal Server Error
2025-09-02T09:21:11Z clientIP="103.213.96.36" requestID="cd14273a-1a3e-4038" responseTimeMS=164 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:11Z clientIP="103.213.96.36" requestID="acc4985c-f9e6-4c3e" responseTimeMS=168 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:11.086794288Z 2025-09-02 09:21:11,086 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:21:11.251589924Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:11.278556632Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:21:12.25287664Z 2025-09-02 09:21:12,252 - backend.services.chinese_payment_service - INFO - Fetching brand list from Chinese API (cache miss)
2025-09-02T09:21:12.253081784Z 2025-09-02 09:21:12,252 - backend.services.chinese_payment_service - DEBUG - Signature string: mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:21:12.253089914Z 2025-09-02 09:21:12,252 - backend.services.chinese_payment_service - DEBUG - Generated signature: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:21:12.917565729Z 2025-09-02 09:21:12,917 - backend.services.chinese_payment_service - INFO - Brand list response status: 200
2025-09-02T09:21:12.918263153Z 2025-09-02 09:21:12,917 - backend.services.chinese_payment_service - DEBUG - Brand list response: {
2025-09-02T09:21:12.918281633Z   "msg": "操作成功",
2025-09-02T09:21:12.918286473Z   "code": 200,
2025-09-02T09:21:12.918290584Z   "data": [
2025-09-02T09:21:12.918294613Z     {
2025-09-02T09:21:12.918298944Z       "e_name": "测试品牌",
2025-09-02T09:21:12.918303414Z       "name": "测试品牌",
2025-09-02T09:21:12.918307624Z       "id": "BR102507260001"
2025-09-02T09:21:12.918312074Z     },
2025-09-02T09:21:12.918316404Z     {
2025-09-02T09:21:12.918320604Z       "e_name": "jiuyun",
2025-09-02T09:21:12.918325684Z       "name": "玖云",
2025-09-02T09:21:12.918330254Z       "id": "BR102508200001"
2025-09-02T09:21:12.918334774Z     },
2025-09-02T09:21:12.918338824Z     {
2025-09-02T09:21:12.918342934Z       "e_name": "Apple",
2025-09-02T09:21:12.918347185Z       "name": "苹果",
2025-09-02T09:21:12.918351395Z       "id": "BR20250111000002"
2025-09-02T09:21:12.918355665Z     },
2025-09-02T09:21:12.918359725Z     {
2025-09-02T09:21:12.918364065Z       "e_name": "SAMSUNG",
2025-09-02T09:21:12.918368845Z       "name": "三星",
2025-09-02T09:21:12.918373235Z       "id": "BR020250120000001"
2025-09-02T09:21:12.918377385Z     },
2025-09-02T09:21:12.918381705Z     {
2025-09-02T09:21:12.918400446Z       "e_name": "HUAWEI",
2025-09-02T09:21:12.918403486Z       "name": "华为",
2025-09-02T09:21:12.918406056Z       "id": "BR102504010001"
2025-09-02T09:21:12.918408636Z     },
2025-09-02T09:21:12.918411046Z     {
2025-09-02T09:21:12.918413506Z       "e_name": "Redmi",
2025-09-02T09:21:12.918415796Z       "name": "红米",
2025-09-02T09:21:12.918418066Z       "id": "BR102504060001"
2025-09-02T09:21:12.918420406Z     },
2025-09-02T09:21:12.918423156Z     {
2025-09-02T09:21:12.918425856Z       "e_name": "OPPO",
2025-09-02T09:21:12.918428346Z       "name": "OPPO",
2025-09-02T09:21:12.918431056Z       "id": "BR102504020001"
2025-09-02T09:21:12.918433316Z     },
2025-09-02T09:21:12.918435706Z     {
2025-09-02T09:21:12.918438256Z       "e_name": "VIVO",
2025-09-02T09:21:12.918440726Z       "name": "VIVO",
2025-09-02T09:21:12.918443247Z       "id": "BR102504020002"
2025-09-02T09:21:12.918446056Z     },
2025-09-02T09:21:12.918448676Z     {
2025-09-02T09:21:12.918451336Z       "e_name": "Xiaomi",
2025-09-02T09:21:12.918453897Z       "name": "小米",
2025-09-02T09:21:12.918456367Z       "id": "BR20250111000001"
2025-09-02T09:21:12Z clientIP="223.160.225.168" requestID="9c852003-3d85-4946" responseTimeMS=668 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:12.918459027Z     },
2025-09-02T09:21:12.918461717Z     {
2025-09-02T09:21:12.918464297Z       "e_name": "HONOR",
2025-09-02T09:21:12.918466947Z       "name": "荣耀",
2025-09-02T09:21:12.918469687Z       "id": "BR102504070001"
2025-09-02T09:21:12.918472397Z     }
2025-09-02T09:21:12.918475057Z   ]
2025-09-02T09:21:12.918477797Z }
2025-09-02T09:21:12.918480337Z 2025-09-02 09:21:12,917 - backend.services.chinese_payment_service - INFO - Successfully fetched 10 brands
2025-09-02T09:21:12.918483267Z 2025-09-02 09:21:12,917 - backend.services.chinese_payment_service - INFO - Cache SET for brand_list
2025-09-02T09:21:12.918745082Z Starting get_brands API call
2025-09-02T09:21:12.918754442Z Device ID received: 
2025-09-02T09:21:12.918757533Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:21:12.918760513Z INFO:     223.160.225.168:0 - "GET /api/brands?device_id= HTTP/1.1" 200 OK
2025-09-02T09:21:25Z clientIP="103.213.96.36" requestID="918b134d-1879-4589" responseTimeMS=122 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:25.772701429Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:21:26Z clientIP="103.213.96.36" requestID="c55d130a-f335-4cb0" responseTimeMS=321 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:26.154281967Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:30Z clientIP="103.213.96.36" requestID="01a3ffbb-f7ff-4fa3" responseTimeMS=123 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:30.885805965Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:21:31Z clientIP="103.213.96.36" requestID="caeb00ee-d823-4ae4" responseTimeMS=106 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:31.138056103Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:33Z clientIP="223.160.225.168" requestID="70489d92-4915-4187" responseTimeMS=2 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:33Z clientIP="223.160.225.168" requestID="21a5dc9e-cf9a-401d" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:33.386172084Z 2025-09-02 09:21:33,385 - backend.services.chinese_payment_service - INFO - Cache HIT for brand_list
2025-09-02T09:21:33.386739425Z Starting get_brands API call
2025-09-02T09:21:33.386756016Z Device ID received: 1517Y7PU1RF3
2025-09-02T09:21:33.386760476Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:21:33.386764916Z INFO:     223.160.225.168:0 - "GET /api/brands?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:21:33.458461969Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/register-user HTTP/1.1" 200 OK
2025-09-02T09:21:34Z clientIP="223.160.225.168" requestID="7b2de00d-de5f-465d" responseTimeMS=739 responseBytes=510 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:34Z clientIP="223.160.225.168" requestID="82d0d150-a707-4e64" responseTimeMS=685 responseBytes=611 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:34.596990374Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:21:34.597016244Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:21:34.597036614Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR20250111000002'}: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:21:34.597040855Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': [{'mobile_shell_id': 'MS102503280001', 'mobile_model_name': 'iPhone 16', 'width': '74.42', 'stock': 4, 'mobile_model_id': 'MM020250221000006', 'height': '150.96'}, {'mobile_shell_id': 'MS102503270001', 'mobile_model_name': 'iPhone 15', 'width': '76.28', 'stock': 7, 'mobile_model_id': 'MM020250224000008', 'height': '151.72'}, {'mobile_shell_id': 'MS102503280004', 'mobile_model_name': 'iPhone 16 Pro Max', 'width': '80.52', 'stock': 6, 'mobile_model_id': 'MM1020250226000002', 'height': '166.03'}]}
2025-09-02T09:21:34.597044105Z INFO:     223.160.225.168:0 - "GET /api/brands/iphone/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:21:34.88392748Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:21:34.883962441Z Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:21:34.883969941Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_091645_838045D7', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:21:34.883973471Z Successfully registered user with session:
2025-09-02T09:21:34.883975611Z - Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:21:34.883978401Z - Machine: 1517Y7PU1RF3
2025-09-02T09:21:34.883982001Z - User Progress: qr_scanned
2025-09-02T09:21:34.883985871Z === REGISTER USER WITH SESSION END ===
2025-09-02T09:21:34.883990321Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/register-user HTTP/1.1" 200 OK
2025-09-02T09:21:35.523342395Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:21:35.523368526Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:21:35.523373356Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR020250120000001'}: eb5f4a668fee97b77dad3b69ed5cf098
2025-09-02T09:21:35Z clientIP="223.160.225.168" requestID="ef582d58-2b39-4cc1" responseTimeMS=462 responseBytes=439 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:21:35.523376836Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': []}
2025-09-02T09:21:35.523380506Z INFO:     223.160.225.168:0 - "GET /api/brands/samsung/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:21:41Z clientIP="103.213.96.36" requestID="dd6683fe-a130-4650" responseTimeMS=122 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:41Z clientIP="103.213.96.36" requestID="0afcc2ff-f16d-4f4c" responseTimeMS=132 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:41.026109712Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:41.299968843Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:21:50Z clientIP="103.213.96.36" requestID="d6309382-b219-44a0" responseTimeMS=115 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:21:50.836899956Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:21:51Z clientIP="103.213.96.36" requestID="6373e8f9-e230-4e6e" responseTimeMS=109 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:21:51.118438957Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:06Z clientIP="103.213.96.36" requestID="9b2c02a1-bcb0-43e1" responseTimeMS=110 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:22:06Z clientIP="103.213.96.36" requestID="c928a2cc-7658-4323" responseTimeMS=106 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:22:06.067372876Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:22:06.441902348Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:10Z clientIP="103.213.96.36" requestID="f243096e-9130-4b34" responseTimeMS=115 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:22:10.862564034Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:22:11Z clientIP="103.213.96.36" requestID="7209f336-1e24-4739" responseTimeMS=107 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:22:11.650396086Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:16Z clientIP="223.160.225.168" requestID="4f58a4ea-a1d1-422c" responseTimeMS=1901 responseBytes=550 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:16Z clientIP="223.160.225.168" requestID="eff8e3cc-d57d-4d95" responseTimeMS=36 responseBytes=2728154 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:16.228801271Z 2025-09-02 09:22:16,228 - backend.services.file_service - INFO - Generated end_user token for order-session_1756804936-final-1756804936-de84ed97.png with 1h expiry
2025-09-02T09:22:16.228838712Z 2025-09-02 09:22:16,228 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804936-final-1756804936-de84ed97.png, partner: end_user
2025-09-02T09:22:16.229434314Z 🔄 API - Upload final image request received
2025-09-02T09:22:16.229446974Z 🔄 API - template_id: classic
2025-09-02T09:22:16.229449884Z 🔄 API - order_id: None
2025-09-02T09:22:16.229453124Z 🔄 API - metadata: {"inputText":"","selectedFont":"Arial","fontSize":30,"selectedTextColor":"#ffffff","selectedBackgroundColor":"#ffffff","textPosition":{"x":50,"y":50},"uploadTimestamp":"2025-09-02T09:22:08.686Z"}
2025-09-02T09:22:16.229456104Z 🔄 API - final_image_data length: 3637102 chars
2025-09-02T09:22:16.229458944Z ✅ Image saved: order-session_1756804936-final-1756804936-de84ed97.png (2727809 bytes)
2025-09-02T09:22:16.229461074Z 🔄 API - Final image saved: order-session_1756804936-final-1756804936-de84ed97.png
2025-09-02T09:22:16.229465714Z 🔄 API - Public URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756808536:end_user:0572650ddb06f371df0c54595299246c4ece42ef44dfaf831adca42f7b666954
2025-09-02T09:22:16.229468934Z INFO:     223.160.225.168:0 - "POST /api/images/upload-final HTTP/1.1" 200 OK
2025-09-02T09:22:16.811992468Z 2025-09-02 09:22:16,811 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: end_user, time remaining: 3600s
2025-09-02T09:22:16.812027858Z 2025-09-02 09:22:16,811 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 223.160.225.168, partner: end_user, time remaining: 3600s
2025-09-02T09:22:16.812520958Z INFO:     223.160.225.168:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756808536:end_user:0572650ddb06f371df0c54595299246c4ece42ef44dfaf831adca42f7b666954 HTTP/1.1" 200 OK
2025-09-02T09:22:19Z clientIP="223.160.225.168" requestID="50d8aacd-7da9-49d1" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:19.933093806Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-summary HTTP/1.1" 200 OK
2025-09-02T09:22:20Z clientIP="103.213.96.36" requestID="fa412a1f-ba6d-4204" responseTimeMS=111 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:22:20.761447562Z 2025-09-02 09:22:20,761 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:22:20.870093269Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:22:21Z clientIP="103.213.96.36" requestID="37b8a38b-48d6-4a53" responseTimeMS=129 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:22:21.158827672Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:28.33780631Z 2025-09-02 09:22:28,337 - backend.services.file_service - INFO - Generated chinese_manufacturing token for order-session_1756804936-final-1756804936-de84ed97.png with 48h expiry
2025-09-02T09:22:28.337835381Z 2025-09-02 09:22:28,337 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing
2025-09-02T09:22:28.512956859Z DEBUG: Processing final image URL for Chinese API: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756808536:end_user:0572650ddb06f371df0c54595299246c4ece42ef44dfaf831adca42f7b666954
2025-09-02T09:22:28.51299813Z DEBUG: Extracted clean filename for token generation: order-session_1756804936-final-1756804936-de84ed97.png
2025-09-02T09:22:28.51300204Z DEBUG: Original URL had tokens: True
2025-09-02T09:22:28.51300504Z ✅ DEBUG: Successfully replaced existing tokens with Chinese manufacturing token
2025-09-02T09:22:28.51300827Z DEBUG: Original URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756808536:end_user:0572650ddb06f371df0c54595299246c4ece42ef44dfaf831adca42f7b666954
2025-09-02T09:22:28.51301138Z DEBUG: New Secure URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977748:chinese_manufacturing:4cde2ed303123249648c28e904a6319f807fb0cd2060327b6e0cd1e7a9c58163
2025-09-02T09:22:28Z clientIP="223.160.225.168" requestID="28f0552e-0133-43d6" responseTimeMS=262 responseBytes=466 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:28.51301451Z DEBUG: Token count in new URL: 1
2025-09-02T09:22:28.51301727Z DEBUG: Storing order summary for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:28.51302027Z DEBUG: Order data keys: ['designImage', 'imageTransforms', 'price', 'brand', 'brand_id', 'model', 'color', 'chinese_model_id', 'mobile_shell_id', 'device_id', 'template', 'inputText', 'selectedFont', 'selectedTextColor', 'selectedBackgroundColor', 'textPosition', 'paymentMethod', 'finalImagePublicUrl']
2025-09-02T09:22:28.51302356Z DEBUG: Session data keys after update: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:22:28.51302615Z DEBUG: Order summary stored: True
2025-09-02T09:22:28.51302849Z DEBUG: Successfully verified order_summary in database for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:28.51303163Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-summary HTTP/1.1" 200 OK
2025-09-02T09:22:29Z clientIP="223.160.225.168" requestID="ba411efb-c6cc-49d0" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:29.039830874Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/init-payment HTTP/1.1" 200 OK
2025-09-02T09:22:29.600819896Z 2025-09-02 09:22:29,600 - backend.services.chinese_payment_service - INFO - Fetching stock list from Chinese API (cache miss) - device_id: 1517Y7PU1RF3, brand_id: BR20250111000002
2025-09-02T09:22:29.600883857Z 2025-09-02 09:22:29,600 - backend.services.chinese_payment_service - DEBUG - Signature string: BR202501110000021517Y7PU1RF3mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:22:29.600979809Z 2025-09-02 09:22:29,600 - backend.services.chinese_payment_service - DEBUG - Generated signature: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:22:30.004988778Z 2025-09-02 09:22:30,004 - backend.services.chinese_payment_service - INFO - Stock list response status: 200
2025-09-02T09:22:30.005165902Z 2025-09-02 09:22:30,005 - backend.services.chinese_payment_service - DEBUG - Stock list response: {
2025-09-02T09:22:30.005173462Z   "msg": "操作成功",
2025-09-02T09:22:30.005177322Z   "code": 200,
2025-09-02T09:22:30.005181042Z   "data": [
2025-09-02T09:22:30.005208073Z     {
2025-09-02T09:22:30.005213093Z       "mobile_shell_id": "MS102503280001",
2025-09-02T09:22:30.005216823Z       "mobile_model_name": "iPhone 16",
2025-09-02T09:22:30.005220333Z       "width": "74.42",
2025-09-02T09:22:30.005223703Z       "stock": 4,
2025-09-02T09:22:30.005227213Z       "mobile_model_id": "MM020250221000006",
2025-09-02T09:22:30.005230683Z       "height": "150.96"
2025-09-02T09:22:30.005234323Z     },
2025-09-02T09:22:30.005238013Z     {
2025-09-02T09:22:30.005255903Z       "mobile_shell_id": "MS102503270001",
2025-09-02T09:22:30.005259723Z       "mobile_model_name": "iPhone 15",
2025-09-02T09:22:30.005263203Z       "width": "76.28",
2025-09-02T09:22:30.005266184Z       "stock": 7,
2025-09-02T09:22:30.005269494Z       "mobile_model_id": "MM020250224000008",
2025-09-02T09:22:30.005272444Z       "height": "151.72"
2025-09-02T09:22:30.005275554Z     },
2025-09-02T09:22:30.005278944Z     {
2025-09-02T09:22:30.005282084Z       "mobile_shell_id": "MS102503280004",
2025-09-02T09:22:30.005285554Z       "mobile_model_name": "iPhone 16 Pro Max",
2025-09-02T09:22:30.005289124Z       "width": "80.52",
2025-09-02T09:22:30.005292544Z       "stock": 6,
2025-09-02T09:22:30.005296354Z       "mobile_model_id": "MM1020250226000002",
2025-09-02T09:22:30.005299704Z       "height": "166.03"
2025-09-02T09:22:30.005303304Z     }
2025-09-02T09:22:30.005306924Z   ]
2025-09-02T09:22:30.005310604Z }
2025-09-02T09:22:30.005331405Z 2025-09-02 09:22:30,005 - backend.services.chinese_payment_service - INFO - Successfully fetched 3 stock items for brand BR20250111000002
2025-09-02T09:22:30.005359916Z 2025-09-02 09:22:30,005 - backend.services.chinese_payment_service - INFO - Cache SET for stock_1517Y7PU1RF3_BR20250111000002
2025-09-02T09:22:30.005665971Z 2025-09-02 09:22:30,005 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST START (BACKEND_1756804950) ===
2025-09-02T09:22:30.005676672Z 2025-09-02 09:22:30,005 - backend.routes.chinese_api - INFO - Client IP: 127.0.0.1
2025-09-02T09:22:30.005805174Z 2025-09-02 09:22:30,005 - backend.routes.chinese_api - INFO - Request payload: {'mobile_model_id': 'MM020250221000006', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902804950', 'pay_amount': 19.99, 'pay_type': 5}
2025-09-02T09:22:30.005845205Z 2025-09-02 09:22:30,005 - backend.routes.chinese_api - INFO - Timestamp: 2025-09-02T09:22:30.005792+00:00
2025-09-02T09:22:30.055705231Z 2025-09-02 09:22:30,055 - backend.routes.chinese_api - WARNING - Mobile model MM020250221000006 not found in database, proceeding anyway
2025-09-02T09:22:30.055768692Z 2025-09-02 09:22:30,055 - backend.routes.chinese_api - INFO - Payment record: {
2025-09-02T09:22:30.055775462Z   "correlation_id": "BACKEND_1756804950",
2025-09-02T09:22:30.055777912Z   "third_id": "PYEN250902804950",
2025-09-02T09:22:30.055780863Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:22:30.055783363Z   "mobile_model_id": "MM020250221000006",
2025-09-02T09:22:30.055786363Z   "pay_amount": 19.99,
2025-09-02T09:22:30.055788953Z   "pay_type": 5,
2025-09-02T09:22:30.055792543Z   "initiated_at": "2025-09-02T09:22:30.055643+00:00",
2025-09-02T09:22:30.055795313Z   "client_ip": "127.0.0.1"
2025-09-02T09:22:30.055798003Z }
2025-09-02T09:22:30.055836793Z 2025-09-02 09:22:30,055 - backend.routes.chinese_api - INFO - Calling Chinese payment service...
2025-09-02T09:22:30.055903475Z 2025-09-02 09:22:30,055 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE START ===
2025-09-02T09:22:30.055936606Z 2025-09-02 09:22:30,055 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:22:30.055974826Z 2025-09-02 09:22:30,055 - backend.services.chinese_payment_service - INFO - Payment details: third_id=PYEN250902804950, amount=19.99, pay_type=5
2025-09-02T09:22:30.056011487Z 2025-09-02 09:22:30,055 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM020250221000006
2025-09-02T09:22:30.056045468Z 2025-09-02 09:22:30,055 - backend.services.chinese_payment_service - INFO - Device ID: 1517Y7PU1RF3
2025-09-02T09:22:30.056072868Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:22:30.05615081Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Authentication successful in 0.00s, token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:22:30.056239101Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - === PAYLOAD TO CHINESE API ===
2025-09-02T09:22:30.056319443Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:22:30.056324913Z   "mobile_model_id": "MM020250221000006",
2025-09-02T09:22:30.056328663Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:22:30.056331553Z   "third_id": "PYEN250902804950",
2025-09-02T09:22:30.056334903Z   "pay_amount": 19.99,
2025-09-02T09:22:30.056337834Z   "pay_type": 5
2025-09-02T09:22:30.056340543Z }
2025-09-02T09:22:30.056348214Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Generating signature...
2025-09-02T09:22:30.056434685Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM02025022100000619.995PYEN250902804950mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:22:30.056503577Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - DEBUG - Generated signature: 7c0a03f2fe848e1b05919d8a4d8ce987
2025-09-02T09:22:30.056563438Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Signature generated in 0.000s: 7c0a03f2fe848e1b05919d8a4d8ce987
2025-09-02T09:22:30.056616849Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - === REQUEST HEADERS ===
2025-09-02T09:22:30.05668967Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Headers: {
2025-09-02T09:22:30.05669302Z   "Authorization": "eyJhbGciOiJIUzUxMiJ9...",
2025-09-02T09:22:30.05669737Z   "sign": "7c0a03f2fe848e1b05919d8a4d8ce987",
2025-09-02T09:22:30.05669925Z   "req_source": "en",
2025-09-02T09:22:30.05670103Z   "Content-Type": "application/json",
2025-09-02T09:22:30.056703101Z   "User-Agent": "PimpMyCase-API/2.0.0"
2025-09-02T09:22:30.056706321Z }
2025-09-02T09:22:30.056728981Z 2025-09-02 09:22:30,056 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:22:30.333786125Z 2025-09-02 09:22:30,333 - backend.services.chinese_payment_service - INFO - HTTP request completed in 0.28s
2025-09-02T09:22:30.333816335Z 2025-09-02 09:22:30,333 - backend.services.chinese_payment_service - INFO - === CHINESE API HTTP RESPONSE ===
2025-09-02T09:22:30.333895607Z 2025-09-02 09:22:30,333 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:22:30.333996669Z 2025-09-02 09:22:30,333 - backend.services.chinese_payment_service - INFO - Response headers: {'Vary': 'Origin, Access-Control-Request-Method, Access-Control-Request-Headers', 'tlogTraceId': '/mobileShell/en/order/payData20250902172230169f5pra018', 'X-Content-Type-Options': 'nosniff', 'X-XSS-Protection': '1; mode=block', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': '0', 'Content-Type': 'application/json;charset=UTF-8', 'Transfer-Encoding': 'chunked', 'Date': 'Tue, 02 Sep 2025 09:22:29 GMT', 'Keep-Alive': 'timeout=60', 'Connection': 'keep-alive'}
2025-09-02T09:22:30.334150262Z 2025-09-02 09:22:30,334 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:22:30.334156112Z   "msg": "操作成功",
2025-09-02T09:22:30.334159832Z   "code": 200,
2025-09-02T09:22:30.334163672Z   "data": {
2025-09-02T09:22:30.334167762Z     "id": "MSPY10250902000006",
2025-09-02T09:22:30.334172042Z     "third_id": "PYEN250902804950"
2025-09-02T09:22:30.334220243Z   }
2025-09-02T09:22:30.334228754Z }
2025-09-02T09:22:30.334259834Z 2025-09-02 09:22:30,334 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment data sent successfully!
2025-09-02T09:22:30.334340706Z 2025-09-02 09:22:30,334 - backend.services.chinese_payment_service - INFO - Chinese Payment ID: MSPY10250902000006
2025-09-02T09:22:30.334391777Z 2025-09-02 09:22:30,334 - backend.services.chinese_payment_service - INFO - Third ID: PYEN250902804950
2025-09-02T09:22:30.334458368Z 2025-09-02 09:22:30,334 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE END (SUCCESS) ===
2025-09-02T09:22:30.334519009Z 2025-09-02 09:22:30,334 - backend.routes.chinese_api - INFO - Chinese API call completed in 0.28s
2025-09-02T09:22:30.33457101Z 2025-09-02 09:22:30,334 - backend.routes.chinese_api - INFO - === CHINESE API RESPONSE (BACKEND_1756804950) ===
2025-09-02T09:22:30.334637302Z 2025-09-02 09:22:30,334 - backend.routes.chinese_api - INFO - Response: {
2025-09-02T09:22:30.334640012Z   "msg": "操作成功",
2025-09-02T09:22:30.334641802Z   "code": 200,
2025-09-02T09:22:30.334655642Z   "data": {
2025-09-02T09:22:30.334658712Z     "id": "MSPY10250902000006",
2025-09-02T09:22:30.334661842Z     "third_id": "PYEN250902804950"
2025-09-02T09:22:30.334664582Z   }
2025-09-02T09:22:30.334667602Z }
2025-09-02T09:22:30.334714173Z 2025-09-02 09:22:30,334 - backend.routes.chinese_api - INFO - SUCCESS: Payment data sent successfully to Chinese API
2025-09-02T09:22:30.334777994Z 2025-09-02 09:22:30,334 - backend.routes.chinese_api - INFO - Chinese Payment ID: MSPY10250902000006
2025-09-02T09:22:30.390196719Z 2025-09-02 09:22:30,390 - backend.routes.chinese_api - INFO - Stored payment mapping in PaymentMapping table: PYEN250902804950 -> MSPY10250902000006
2025-09-02T09:22:30.39025066Z 2025-09-02 09:22:30,390 - backend.routes.chinese_api - INFO - Mapped payment third_id PYEN250902804950 -> Chinese payment id MSPY10250902000006
2025-09-02T09:22:30.390318922Z 2025-09-02 09:22:30,390 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST END (BACKEND_1756804950) ===
2025-09-02T09:22:30.473443069Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Adding payment data for third_id PYEN250902804950
2025-09-02T09:22:30.47347746Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Updating session_data for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.47349406Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - Updates: ['payment_data', 'chinese_third_id']
2025-09-02T09:22:30.473556231Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - Merge strategy: update
2025-09-02T09:22:30.473647953Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO - 🔄 Attempt 1/3: Storing session_data
2025-09-02T09:22:30.473686254Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - Original keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:22:30.473769375Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - New keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id']
2025-09-02T09:22:30.473954559Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - SQLAlchemy dirty objects: 1
2025-09-02T09:22:30.473980259Z 2025-09-02 09:22:30,473 - backend.utils.session_data_manager - INFO -    - Session object in dirty set: True
2025-09-02T09:22:30.530802082Z 2025-09-02 09:22:30,530 - backend.utils.session_data_manager - INFO - ✅ Session data committed successfully
2025-09-02T09:22:30.616882327Z 2025-09-02 09:22:30,616 - backend.utils.session_data_manager - INFO - ✅ Verification: All expected data found in database for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.616908518Z 2025-09-02 09:22:30,616 - backend.utils.session_data_manager - INFO - ✅ SessionDataManager: Persistence verified for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.616996459Z 2025-09-02 09:22:30,616 - backend.utils.session_data_manager - INFO - 🔄 SessionDataManager: Updating session_data for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.61703765Z 2025-09-02 09:22:30,616 - backend.utils.session_data_manager - INFO -    - Updates: ['chinese_payment_id', 'chinese_response']
2025-09-02T09:22:30.617134862Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO -    - Merge strategy: update
2025-09-02T09:22:30.617177853Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO - 🔄 Attempt 1/3: Storing session_data
2025-09-02T09:22:30.617305305Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO -    - Original keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id']
2025-09-02T09:22:30.617351706Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO -    - New keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response']
2025-09-02T09:22:30.61755969Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO -    - SQLAlchemy dirty objects: 1
2025-09-02T09:22:30.617623442Z 2025-09-02 09:22:30,617 - backend.utils.session_data_manager - INFO -    - Session object in dirty set: True
2025-09-02T09:22:30.6732178Z 2025-09-02 09:22:30,673 - backend.utils.session_data_manager - INFO - ✅ Session data committed successfully
2025-09-02T09:22:30.752086164Z 2025-09-02 09:22:30,751 - backend.utils.session_data_manager - INFO - ✅ Verification: All expected data found in database for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.752111804Z 2025-09-02 09:22:30,752 - backend.utils.session_data_manager - INFO - ✅ SessionDataManager: Persistence verified for 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.803035492Z 🔍 DEBUG - Extracted order details:
2025-09-02T09:22:30.803056712Z   - brand_name: 'iphone'
2025-09-02T09:22:30.803059802Z   - brand_id: 'BR20250111000002'
2025-09-02T09:22:30.803061992Z   - model_name: 'iPhone 16'
2025-09-02T09:22:30.803066652Z   - Available order_summary keys: ['designImage', 'imageTransforms', 'price', 'brand', 'brand_id', 'model', 'color', 'chinese_model_id', 'mobile_shell_id', 'device_id', 'template', 'inputText', 'selectedFont', 'selectedTextColor', 'selectedBackgroundColor', 'textPosition', 'paymentMethod', 'finalImagePublicUrl']
2025-09-02T09:22:30.803069382Z 🚀 Calling get_chinese_stock with:
2025-09-02T09:22:30Z clientIP="223.160.225.168" requestID="2e90077a-63ce-4282" responseTimeMS=1301 responseBytes=600 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:30Z clientIP="103.213.96.36" requestID="f1f89384-a344-49c4" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:22:30.803071712Z   - device_id (machine_id): '1517Y7PU1RF3'
2025-09-02T09:22:30.803073802Z   - brand_id: 'BR20250111000002'
2025-09-02T09:22:30.803075912Z 📦 Stock validation result: True, items: 3
2025-09-02T09:22:30.803078302Z ✅ Stock validated: iPhone 16 (ID: MM020250221000006, Shell: MS102503280001) has 4 units
2025-09-02T09:22:30.803091602Z Backend - Generated third_id (UTC): PYEN250902804950
2025-09-02T09:22:30.803094083Z ✅ PayData successful, now calling orderData immediately...
2025-09-02T09:22:30.803096503Z ✅ PayData successful for vending machine payment
2025-09-02T09:22:30.803099133Z 💳 Payment initialized with Chinese payment ID: MSPY10250902000006
2025-09-02T09:22:30.803101313Z 🔄 Vending machine will now process physical payment...
2025-09-02T09:22:30.803103433Z 📱 User should complete payment on vending machine
2025-09-02T09:22:30.803105573Z ⏳ System will receive payStatus webhook when payment confirmed
2025-09-02T09:22:30.803107773Z 🔍 DEBUG - BEFORE using SessionDataManager:
2025-09-02T09:22:30.803109983Z   - session_id: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:30.803113853Z   - existing session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url']
2025-09-02T09:22:30.803116213Z   - session status: active
2025-09-02T09:22:30.803118393Z   - third_id to store: PYEN250902804950
2025-09-02T09:22:30.803120553Z 🔄 Using SessionDataManager to store payment data...
2025-09-02T09:22:30.803122723Z ✅ CRITICAL SUCCESS: Payment data stored using SessionDataManager!
2025-09-02T09:22:30.803124793Z    - third_id: PYEN250902804950
2025-09-02T09:22:30.803127083Z    - Payment data persistence: ✅ VERIFIED
2025-09-02T09:22:30.803129283Z    - Additional data persistence: ✅ VERIFIED
2025-09-02T09:22:30.803132123Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/init-payment HTTP/1.1" 200 OK
2025-09-02T09:22:30.993855157Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:46Z clientIP="223.160.225.168" requestID="ec5b5362-135e-4d57" responseTimeMS=267 responseBytes=1550 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:46.33674788Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/status HTTP/1.1" 200 OK
2025-09-02T09:22:50.759824625Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:22:50.766784551Z 2025-09-02 09:22:50,766 - backend.routes.chinese_api - INFO - === PAYSTATUS WEBHOOK WITH SESSIONDATAMANAGER ===
2025-09-02T09:22:50.766819601Z 2025-09-02 09:22:50,766 - backend.routes.chinese_api - INFO - 🔍 Searching for vending session with third_id: PYEN250902804950
2025-09-02T09:22:50.766908343Z 2025-09-02 09:22:50,766 - backend.utils.session_data_manager - INFO - 🔍 SessionDataManager: Searching for session with third_id PYEN250902804950
2025-09-02T09:22:50.876857376Z 2025-09-02 09:22:50,876 - backend.utils.session_data_manager - INFO - 📊 Found 26 sessions to search
2025-09-02T09:22:50.876898277Z 2025-09-02 09:22:50,876 - backend.utils.session_data_manager - INFO - ✅ Found session 1517Y7PU1RF3_20250902_091645_838045D7 by payment_data.third_id
2025-09-02T09:22:50.876902547Z 2025-09-02 09:22:50,876 - backend.routes.chinese_api - INFO - ✅ FOUND MATCHING VENDING SESSION: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:50Z clientIP="103.213.96.36" requestID="f5f17c14-394f-4b71" responseTimeMS=114 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:22:50.876905317Z 2025-09-02 09:22:50,876 - backend.routes.chinese_api - INFO - 🎯 SessionDataManager result: vending_session = 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:50.876916857Z 2025-09-02 09:22:50,876 - backend.routes.chinese_api - INFO - === VENDING PAYMENT CONFIRMED - TRIGGERING ORDER DATA ===
2025-09-02T09:22:50.877026419Z 2025-09-02 09:22:50,876 - backend.routes.chinese_api - INFO - Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:50.877115881Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Third ID: PYEN250902804950
2025-09-02T09:22:50.877156752Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Payment Status: 3
2025-09-02T09:22:50.877273784Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - 🔒 PROCESSING IMAGE URL FOR CHINESE API TOKEN GENERATION
2025-09-02T09:22:50.877388596Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Original URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977748:chinese_manufacturing:4cde2ed303123249648c28e904a6319f807fb0cd2060327b6e0cd1e7a9c58163
2025-09-02T09:22:50.877477148Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Extracted clean filename: order-session_1756804936-final-1756804936-de84ed97.png
2025-09-02T09:22:50.877486438Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Original URL had tokens: True
2025-09-02T09:22:50.877708392Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - 🔒 Generating NEW secure URL with ONLY chinese_manufacturing token...
2025-09-02T09:22:50.877714403Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - 🔒 Input filename (clean): order-session_1756804936-final-1756804936-de84ed97.png
2025-09-02T09:22:50.877860215Z 2025-09-02 09:22:50,877 - backend.services.file_service - INFO - Generated chinese_manufacturing token for order-session_1756804936-final-1756804936-de84ed97.png with 48h expiry
2025-09-02T09:22:50.877872506Z 2025-09-02 09:22:50,877 - backend.services.file_service - INFO - Generated secure URL for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing
2025-09-02T09:22:50.878010689Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - ✅ SUCCESSFULLY generated Chinese API partner token
2025-09-02T09:22:50.878116831Z 2025-09-02 09:22:50,877 - backend.routes.chinese_api - INFO - Original URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977748:chinese_manufacturing:4cde2ed303123249648c28e904a6319f807fb0cd2060327b6e0cd1e7a9c58163
2025-09-02T09:22:50.878120921Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - New Clean URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:50.878220062Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - Filename: order-session_1756804936-final-1756804936-de84ed97.png
2025-09-02T09:22:50.878374425Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - ✅ Token count validation: 1 (correct)
2025-09-02T09:22:50.878458147Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - ✅ Token validation passed - format is correct with 3 components
2025-09-02T09:22:50.878473147Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - ✅ Token partner type: chinese_manufacturing
2025-09-02T09:22:50.878560859Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - 🔍 FINAL URL VALIDATION BEFORE CHINESE API CALL
2025-09-02T09:22:50.87861774Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - Final image URL to validate: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:50.878711262Z 2025-09-02 09:22:50,878 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172800s
2025-09-02T09:22:50.878820944Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - ✅ URL VALIDATION PASSED
2025-09-02T09:22:50.878851015Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - Partner type: chinese_manufacturing
2025-09-02T09:22:50.878925146Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - Time remaining: 172800s
2025-09-02T09:22:50.879039119Z 2025-09-02 09:22:50,878 - backend.routes.chinese_api - INFO - Expires at: 1756977770
2025-09-02T09:22:50.879155801Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - 🚀 CALLING ORDERDATA ENDPOINT NOW
2025-09-02T09:22:50.879227802Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Sending orderData to Chinese API after payment confirmation and URL validation
2025-09-02T09:22:50.879375205Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Payment Third ID: PYEN250902804950
2025-09-02T09:22:50.879410086Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Order Third ID: OREN756804970878
2025-09-02T09:22:50.879534958Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Mobile Model ID: MM020250221000006
2025-09-02T09:22:50.879598809Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Device ID: 1517Y7PU1RF3
2025-09-02T09:22:50.879701371Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - Validated Image URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:50.879809734Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO - 📋 OrderData parameters:
2025-09-02T09:22:50.879890665Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO -   - third_pay_id: PYEN250902804950
2025-09-02T09:22:50.880008728Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO -   - third_id: OREN756804970878
2025-09-02T09:22:50.880013258Z 2025-09-02 09:22:50,879 - backend.routes.chinese_api - INFO -   - mobile_model_id: MM020250221000006
2025-09-02T09:22:50.880218662Z 2025-09-02 09:22:50,880 - backend.routes.chinese_api - INFO -   - pic: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:50.880229222Z 2025-09-02 09:22:50,880 - backend.routes.chinese_api - INFO -   - device_id: 1517Y7PU1RF3
2025-09-02T09:22:50.880323474Z 2025-09-02 09:22:50,880 - backend.routes.chinese_api - INFO -   - mobile_shell_id: MS102503280001
2025-09-02T09:22:50.880479057Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION START ===
2025-09-02T09:22:50.880581239Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:22:50.880585599Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Order details: third_pay_id=PYEN250902804950, third_id=OREN756804970878
2025-09-02T09:22:50.88065486Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM020250221000006, device_id: 1517Y7PU1RF3
2025-09-02T09:22:50.880802923Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Mobile shell ID: MS102503280001
2025-09-02T09:22:50.880808373Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Design image URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:50.880875345Z 2025-09-02 09:22:50,880 - backend.services.chinese_payment_service - INFO - Waiting 3 seconds for Chinese API to process payment before sending order data...
2025-09-02T09:22:53.88143411Z 2025-09-02 09:22:53,880 - backend.services.chinese_payment_service - INFO - 3-second delay completed, proceeding with order data submission
2025-09-02T09:22:53.881452321Z 2025-09-02 09:22:53,881 - backend.services.chinese_payment_service - INFO - 🔒 PRESERVING authentication tokens in URL for Chinese API access
2025-09-02T09:22:53.881632764Z 2025-09-02 09:22:53,881 - backend.services.chinese_payment_service - INFO - Full authenticated URL: https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:53.88189684Z 2025-09-02 09:22:53,881 - backend.services.chinese_payment_service - INFO - ✅ URL contains required authentication token
2025-09-02T09:22:53.88193759Z 2025-09-02 09:22:53,881 - backend.services.chinese_payment_service - INFO - ✅ Token validation passed: 1 token parameter
2025-09-02T09:22:53.882516902Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - INFO - ✅ Using AUTHENTICATED URL for Chinese API (NOT shortened): https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f
2025-09-02T09:22:53.882608353Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - INFO - === ORDER DATA PAYLOAD ===
2025-09-02T09:22:53.882613494Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:22:53.882616683Z   "third_pay_id": "PYEN250902804950",
2025-09-02T09:22:53.882619094Z   "third_id": "OREN756804970878",
2025-09-02T09:22:53.882639334Z   "mobile_model_id": "MM020250221000006",
2025-09-02T09:22:53.882642874Z   "pic": "https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f",
2025-09-02T09:22:53.882646484Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:22:53.882648914Z   "mobile_shell_id": "MS102503280001"
2025-09-02T09:22:53.882651414Z }
2025-09-02T09:22:53.882654574Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM020250221000006MS102503280001https://pimpmycase.onrender.com/image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001fOREN756804970878PYEN250902804950mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:22:53.882657604Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - DEBUG - Generated signature: 7bc86d2223ba513596efd09d24af7469
2025-09-02T09:22:53.882660755Z 2025-09-02 09:22:53,882 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:22:54.186145626Z 2025-09-02 09:22:54,185 - backend.services.chinese_payment_service - INFO - Order data request completed in 0.30s
2025-09-02T09:22:54.186161466Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - === CHINESE API ORDER DATA RESPONSE ===
2025-09-02T09:22:54.186320329Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:22:54.186530814Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:22:54.186536894Z   "msg": "操作成功",
2025-09-02T09:22:54.186539704Z   "code": 200,
2025-09-02T09:22:54.186542304Z   "data": {
2025-09-02T09:22:54.186545684Z     "id": "MSOR10250902000004",
2025-09-02T09:22:54.186564054Z     "third_id": "OREN756804970878",
2025-09-02T09:22:54.186567844Z     "queue_no": "4529",
2025-09-02T09:22:54.186570634Z     "status": 4
2025-09-02T09:22:54.186573625Z   }
2025-09-02T09:22:54.186576925Z }
2025-09-02T09:22:54.186579915Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - SUCCESS: Order data sent successfully!
2025-09-02T09:22:54.186588925Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - Chinese Order ID: MSOR10250902000004
2025-09-02T09:22:54.186747668Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - Queue Number: 4529
2025-09-02T09:22:54.186753158Z 2025-09-02 09:22:54,186 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION END (SUCCESS) ===
2025-09-02T09:22:54.186936042Z 2025-09-02 09:22:54,186 - backend.routes.chinese_api - INFO - ✅ ORDERDATA CALL COMPLETED!
2025-09-02T09:22:54.187003673Z 2025-09-02 09:22:54,186 - backend.routes.chinese_api - INFO - OrderData response: {
2025-09-02T09:22:54.187008053Z   "msg": "操作成功",
2025-09-02T09:22:54.187010633Z   "code": 200,
2025-09-02T09:22:54.187013413Z   "data": {
2025-09-02T09:22:54.187015943Z     "id": "MSOR10250902000004",
2025-09-02T09:22:54.187018543Z     "third_id": "OREN756804970878",
2025-09-02T09:22:54.187020783Z     "queue_no": "4529",
2025-09-02T09:22:54.187023193Z     "status": 4
2025-09-02T09:22:54.187025563Z   }
2025-09-02T09:22:54.187027814Z }
2025-09-02T09:22:54.187259118Z 2025-09-02 09:22:54,187 - backend.routes.chinese_api - INFO - ✅ Order successfully sent to Chinese API - Session 1517Y7PU1RF3_20250902_091645_838045D7 payment completed
2025-09-02T09:22:54.187273758Z 2025-09-02 09:22:54,187 - backend.routes.chinese_api - INFO - ✅ Queue number: 4529
2025-09-02T09:22:54.243476248Z === PAYSTATUS WEBHOOK RECEIVED ===
2025-09-02T09:22:54.243499899Z Payment status update from 103.213.96.36: PYEN250902804950 -> status 3
2025-09-02T09:22:54.243504379Z Request data: {'third_id': 'PYEN250902804950', 'status': 3}
2025-09-02T09:22:54Z clientIP="103.213.96.36" requestID="8264bbf5-02fb-41af" responseTimeMS=3483 responseBytes=354 userAgent="Mozilla/5.0"
2025-09-02T09:22:54Z clientIP="103.213.96.36" requestID="971ae0c9-4056-455c" responseTimeMS=1069 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:22:54Z clientIP="223.160.225.168" requestID="bc817183-fdad-4846" responseTimeMS=2552 responseBytes=1625 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:54.243506909Z Current time: 2025-09-02T09:22:50.766603+00:00
2025-09-02T09:22:54.243509589Z === ENHANCED PAYSTATUS WEBHOOK WITH SESSIONDATAMANAGER ===
2025-09-02T09:22:54.243512279Z 🔍 Searching for vending session with third_id: PYEN250902804950
2025-09-02T09:22:54.243514619Z ⏰ Webhook received at: 2025-09-02T09:22:50.766621+00:00
2025-09-02T09:22:54.243516989Z ✅ FOUND MATCHING VENDING SESSION: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:54.243520449Z    - Status: payment_pending
2025-09-02T09:22:54.243522789Z    - User progress: payment_pending
2025-09-02T09:22:54.2435251Z    - Created: 2025-09-02 09:16:45.873920+00:00
2025-09-02T09:22:54.24352754Z    - Last activity: 2025-09-02 09:22:46.166254+00:00
2025-09-02T09:22:54.24353097Z    - Payment data keys: ['third_id', 'amount', 'mobile_model_id', 'device_id', 'pay_type', 'payment_initiated_at', 'mobile_shell_id']
2025-09-02T09:22:54.24354749Z    - Payment data third_id: PYEN250902804950
2025-09-02T09:22:54.2435503Z    - Payment amount: 19.99
2025-09-02T09:22:54.24355274Z    - Mobile model ID: MM020250221000006
2025-09-02T09:22:54.24355544Z    - Device ID: 1517Y7PU1RF3
2025-09-02T09:22:54.24355834Z 🎯 SessionDataManager result: vending_session = 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:54.24356078Z === END ENHANCED PAYSTATUS WEBHOOK ===
2025-09-02T09:22:54.24356295Z ✅ Found vending session: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:54.243565Z Payment status received: 3 (expected: 3 for success)
2025-09-02T09:22:54.2435675Z === ✅ VENDING PAYMENT CONFIRMED - TRIGGERING ORDER DATA ===
2025-09-02T09:22:54.24357009Z Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:54.243572941Z Third ID: PYEN250902804950
2025-09-02T09:22:54.24357585Z Payment Status: 3
2025-09-02T09:22:54.243578321Z Time: 2025-09-02T09:22:50.876780+00:00
2025-09-02T09:22:54.243580531Z 🚀 CALLING ORDERDATA ENDPOINT NOW:
2025-09-02T09:22:54.243583061Z URL: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:22:54.243585271Z ✅ ORDERDATA CALL COMPLETED!
2025-09-02T09:22:54.243587501Z Response: {
2025-09-02T09:22:54.243589881Z   "msg": "操作成功",
2025-09-02T09:22:54.243592011Z   "code": 200,
2025-09-02T09:22:54.243594121Z   "data": {
2025-09-02T09:22:54.243596161Z     "id": "MSOR10250902000004",
2025-09-02T09:22:54.243598531Z     "third_id": "OREN756804970878",
2025-09-02T09:22:54.243601171Z     "queue_no": "4529",
2025-09-02T09:22:54.243603771Z     "status": 4
2025-09-02T09:22:54.243605991Z   }
2025-09-02T09:22:54.243608831Z }
2025-09-02T09:22:54.243611421Z INFO:     103.213.96.36:0 - "POST /api/chinese/order/payStatus HTTP/1.1" 200 OK
2025-09-02T09:22:54.436271623Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:22:54.436967457Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/status HTTP/1.1" 200 OK
2025-09-02T09:22:55Z clientIP="223.160.225.168" requestID="93d76dc0-8bd2-44a4" responseTimeMS=166 responseBytes=1625 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:55.056841523Z 2025-09-02 09:22:55,055 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:22:55.056860633Z 2025-09-02 09:22:55,055 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:22:55.057169819Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:55.084049486Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/status HTTP/1.1" 200 OK
2025-09-02T09:22:55.184069884Z 2025-09-02 09:22:55,183 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:22:55.184714716Z 2025-09-02 09:22:55,184 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172795s
2025-09-02T09:22:55.185607184Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:55Z clientIP="113.68.252.164" requestID="63240fa4-df19-45ee" responseTimeMS=35 responseBytes=2728154 userAgent=""
2025-09-02T09:22:55Z clientIP="113.68.252.164" requestID="39d25c25-d85d-4eba" responseTimeMS=163 responseBytes=2728154 userAgent=""
2025-09-02T09:22:56Z clientIP="223.160.225.168" requestID="b22a4ad8-9f2f-4227" responseTimeMS=2 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:56.952027798Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:22:57Z clientIP="223.160.225.168" requestID="87abf4f4-87f1-4b62" responseTimeMS=170 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:57Z clientIP="113.68.252.164" requestID="d2ee2f9f-1f9d-49fa" responseTimeMS=129 responseBytes=2728154 userAgent=""
2025-09-02T09:22:57.19830258Z 2025-09-02 09:22:57,197 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172793s
2025-09-02T09:22:57.19832205Z 2025-09-02 09:22:57,198 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172793s
2025-09-02T09:22:57.19881125Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:57.719620106Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:57.719640317Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:22:57.719643997Z DEBUG: Session has session_data: True
2025-09-02T09:22:57.719650737Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:22:57.719654707Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:22:58Z clientIP="113.68.252.164" requestID="27d7edf4-7010-4438" responseTimeMS=171 responseBytes=2728154 userAgent=""
2025-09-02T09:22:58Z clientIP="113.68.252.164" requestID="afb540af-5deb-4ff7" responseTimeMS=125 responseBytes=2728154 userAgent=""
2025-09-02T09:22:58Z clientIP="223.160.225.168" requestID="126d3aae-634f-4f8a" responseTimeMS=178 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:58.36795234Z 2025-09-02 09:22:58,367 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172792s
2025-09-02T09:22:58.368032761Z 2025-09-02 09:22:58,367 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172792s
2025-09-02T09:22:58.368703345Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:58.368712915Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:22:58.368716435Z DEBUG: Session has session_data: True
2025-09-02T09:22:58.368719525Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:22:58.368723065Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:22:58.368876078Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:58.557233176Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:58.557262786Z 2025-09-02 09:22:58,555 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172792s
2025-09-02T09:22:58.557278887Z 2025-09-02 09:22:58,555 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172792s
2025-09-02T09:22:59Z clientIP="113.68.252.164" requestID="1fa72388-1e91-41e9" responseTimeMS=14 responseBytes=2728154 userAgent=""
2025-09-02T09:22:59Z clientIP="223.160.225.168" requestID="83f3b150-47f8-49dc" responseTimeMS=375 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:59Z clientIP="223.160.225.168" requestID="cb0754bd-fe07-4d5d" responseTimeMS=165 responseBytes=778 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:22:59.166894322Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:59.166914302Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:22:59.166918693Z DEBUG: Session has session_data: True
2025-09-02T09:22:59.166923323Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:22:59.166926663Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:22:59.18364131Z 2025-09-02 09:22:59,183 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172791s
2025-09-02T09:22:59.184051598Z 2025-09-02 09:22:59,183 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172791s
2025-09-02T09:22:59.184500507Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:22:59.781827612Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:22:59.781857662Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:22:59.781861442Z DEBUG: Session has session_data: True
2025-09-02T09:22:59.781864973Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:22:59.781868753Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:23:00Z clientIP="223.160.225.168" requestID="16bbc2d0-79ff-4a99" responseTimeMS=174 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:23:00.386574242Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:23:00.386592662Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:23:00.386596142Z DEBUG: Session has session_data: True
2025-09-02T09:23:00.386598982Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:23:00.386602473Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:23:00.994335301Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:23:00.994353152Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:23:00.994368002Z DEBUG: Session has session_data: True
2025-09-02T09:23:00.994371152Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:23:00.994374192Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:23:01Z clientIP="223.160.225.168" requestID="ef55cea6-09e3-4eac" responseTimeMS=168 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:23:01Z clientIP="113.68.252.164" requestID="c3e09782-9384-4a3c" responseTimeMS=35 responseBytes=2728154 userAgent=""
2025-09-02T09:23:01Z clientIP="103.213.96.36" requestID="6304b3e7-b9a3-4a48" responseTimeMS=110 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:01Z clientIP="103.213.96.36" requestID="81723595-c400-41be" responseTimeMS=168 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:01Z clientIP="223.160.225.168" requestID="a7bbda38-35b8-4b60" responseTimeMS=249 responseBytes=777 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:23:01.102868306Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:01.477748246Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:01.658114137Z 2025-09-02 09:23:01,655 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172789s
2025-09-02T09:23:01.658132128Z 2025-09-02 09:23:01,656 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172789s
2025-09-02T09:23:01.658633567Z DEBUG: Retrieving order info for session 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:23:01.658645578Z DEBUG: Session status: payment_completed, progress: order_submitted
2025-09-02T09:23:01.658650438Z DEBUG: Session has session_data: True
2025-09-02T09:23:01.658655048Z DEBUG: Session 1517Y7PU1RF3_20250902_091645_838045D7 session_data keys: ['qr_scanned_at', 'user_agent', 'ip_address', 'location', 'security_validated', 'scan_security_info', 'order_summary', 'payment_amount', 'currency', 'payment_requested_at', 'order_security_info', 'final_image_url', 'original_image_url', 'payment_data', 'chinese_third_id', 'chinese_payment_id', 'chinese_response', 'chinese_order_response', 'order_third_id', 'payment_confirmed_at', 'queue_number']
2025-09-02T09:23:01.658659428Z INFO:     223.160.225.168:0 - "GET /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-info HTTP/1.1" 200 OK
2025-09-02T09:23:01.658664558Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:02Z clientIP="103.213.96.36" requestID="d56b8e12-e7eb-4368" responseTimeMS=109 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:02.659095175Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:03Z clientIP="113.68.252.164" requestID="c4aa6533-f2a1-42a1" responseTimeMS=12 responseBytes=2728154 userAgent=""
2025-09-02T09:23:03.544508301Z 2025-09-02 09:23:03,544 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172787s
2025-09-02T09:23:03.544530931Z 2025-09-02 09:23:03,544 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172787s
2025-09-02T09:23:03.545036071Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:05Z clientIP="113.68.252.164" requestID="1e8f59bb-e587-41bc" responseTimeMS=11 responseBytes=2728154 userAgent=""
2025-09-02T09:23:05.496301485Z 2025-09-02 09:23:05,495 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172785s
2025-09-02T09:23:05.496321406Z 2025-09-02 09:23:05,496 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172785s
2025-09-02T09:23:05.496650282Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:09Z clientIP="113.68.252.164" requestID="8ec25543-de3f-452f" responseTimeMS=13 responseBytes=2728154 userAgent=""
2025-09-02T09:23:09.861557484Z 2025-09-02 09:23:09,861 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172781s
2025-09-02T09:23:09.861751588Z 2025-09-02 09:23:09,861 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172781s
2025-09-02T09:23:09.86238489Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:11Z clientIP="103.213.96.36" requestID="2882dc6f-eb04-4f96" responseTimeMS=117 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:11Z clientIP="113.68.252.164" requestID="bfc967c7-ffaf-47b2" responseTimeMS=16 responseBytes=2728154 userAgent=""
2025-09-02T09:23:11.140904613Z 2025-09-02 09:23:11,140 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172779s
2025-09-02T09:23:11.141334351Z 2025-09-02 09:23:11,141 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172779s
2025-09-02T09:23:11.141633737Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:11.303505877Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:13Z clientIP="113.68.252.164" requestID="3f0205c9-3ee4-4844" responseTimeMS=16 responseBytes=2728154 userAgent=""
2025-09-02T09:23:13Z clientIP="103.213.96.36" requestID="f9766b6c-dd07-4325" responseTimeMS=113 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:13Z clientIP="103.213.96.36" requestID="00f12ea2-f6a5-4d69" responseTimeMS=107 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:13.141916302Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:13.473630007Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:13.868903416Z 2025-09-02 09:23:13,868 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172777s
2025-09-02T09:23:13.869335475Z 2025-09-02 09:23:13,868 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172777s
2025-09-02T09:23:13.869541189Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:16.413853036Z 2025-09-02 09:23:16,413 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172774s
2025-09-02T09:23:16.413872276Z 2025-09-02 09:23:16,413 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172774s
2025-09-02T09:23:16Z clientIP="113.68.252.164" requestID="13798687-5888-4c11" responseTimeMS=12 responseBytes=2728154 userAgent=""
2025-09-02T09:23:16.414315565Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:20Z clientIP="113.68.252.164" requestID="b611fe04-6a52-4eca" responseTimeMS=16 responseBytes=2728154 userAgent=""
2025-09-02T09:23:20.659553017Z 2025-09-02 09:23:20,659 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172770s
2025-09-02T09:23:20.659624078Z 2025-09-02 09:23:20,659 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172770s
2025-09-02T09:23:20.660624328Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:21Z clientIP="113.68.252.164" requestID="f41aa323-2f37-4d5f" responseTimeMS=17 responseBytes=2728154 userAgent=""
2025-09-02T09:23:21.949435353Z 2025-09-02 09:23:21,949 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172769s
2025-09-02T09:23:21.949459303Z 2025-09-02 09:23:21,949 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172769s
2025-09-02T09:23:21.94981434Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:22Z clientIP="113.68.252.164" requestID="6a4da4b1-89d6-4361" responseTimeMS=18 responseBytes=2728154 userAgent=""
2025-09-02T09:23:22.875581637Z 2025-09-02 09:23:22,875 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172768s
2025-09-02T09:23:22.87575155Z 2025-09-02 09:23:22,875 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172768s
2025-09-02T09:23:22.879233269Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:25.97016675Z 2025-09-02 09:23:25,969 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:23:26Z clientIP="103.213.96.36" requestID="816ccfa9-d4c0-4bfe" responseTimeMS=335 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:26Z clientIP="103.213.96.36" requestID="b1bc735c-ec9c-4135" responseTimeMS=303 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:26.298743734Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:26.334815931Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:27Z clientIP="113.68.252.164" requestID="2fa41ec4-dfaa-4265" responseTimeMS=31 responseBytes=2728154 userAgent=""
2025-09-02T09:23:27.055986281Z 2025-09-02 09:23:27,055 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172763s
2025-09-02T09:23:27.056013672Z 2025-09-02 09:23:27,055 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172763s
2025-09-02T09:23:27.056514142Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:28Z clientIP="103.213.96.36" requestID="b70e1ecb-4824-464b" responseTimeMS=144 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:28.196356161Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:29Z clientIP="113.68.252.164" requestID="8137eefb-d4c9-4cc8" responseTimeMS=18 responseBytes=2728154 userAgent=""
2025-09-02T09:23:29Z clientIP="113.68.252.164" requestID="375e2018-d7e1-4cdc" responseTimeMS=16 responseBytes=2728154 userAgent=""
2025-09-02T09:23:29.257526139Z 2025-09-02 09:23:29,257 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172761s
2025-09-02T09:23:29.258046869Z 2025-09-02 09:23:29,257 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172761s
2025-09-02T09:23:29.25858031Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:29.891458632Z 2025-09-02 09:23:29,891 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172761s
2025-09-02T09:23:29.891654356Z 2025-09-02 09:23:29,891 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172761s
2025-09-02T09:23:29.892409291Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:30Z clientIP="103.213.96.36" requestID="c71a88f1-be95-4258" responseTimeMS=112 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:30Z clientIP="103.213.96.36" requestID="33c02296-0127-47ca" responseTimeMS=115 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:30.788259712Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:30.955632949Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:31Z clientIP="103.213.96.36" requestID="01b47cdd-9e57-45ef" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:31.953866285Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:33Z clientIP="113.68.252.164" requestID="6d53c9b3-f4db-4d36" responseTimeMS=30 responseBytes=2728154 userAgent=""
2025-09-02T09:23:33.471732527Z 2025-09-02 09:23:33,471 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172757s
2025-09-02T09:23:33.471781728Z 2025-09-02 09:23:33,471 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172757s
2025-09-02T09:23:33.472288848Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:35Z clientIP="113.68.252.164" requestID="ad4e225b-4875-453b" responseTimeMS=28 responseBytes=2728154 userAgent=""
2025-09-02T09:23:35.532410487Z 2025-09-02 09:23:35,532 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172755s
2025-09-02T09:23:35.532439538Z 2025-09-02 09:23:35,532 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172755s
2025-09-02T09:23:35.532888777Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:36.905141447Z 2025-09-02 09:23:36,904 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172754s
2025-09-02T09:23:36.905165617Z 2025-09-02 09:23:36,904 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172754s
2025-09-02T09:23:36.905665137Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:36Z clientIP="113.68.252.164" requestID="22554035-593f-43f2" responseTimeMS=27 responseBytes=2728154 userAgent=""
2025-09-02T09:23:39Z clientIP="113.68.252.164" requestID="79499cdc-84f9-4b56" responseTimeMS=10 responseBytes=2728154 userAgent=""
2025-09-02T09:23:39.824039843Z 2025-09-02 09:23:39,823 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172751s
2025-09-02T09:23:39.824077984Z 2025-09-02 09:23:39,824 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172751s
2025-09-02T09:23:39.824589343Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:40Z clientIP="103.213.96.36" requestID="64630eee-278c-4866" responseTimeMS=134 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:40.836280214Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:42Z clientIP="103.213.96.36" requestID="4c00bf84-2dde-41f5" responseTimeMS=110 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:42Z clientIP="113.68.252.164" requestID="ec632238-c4be-402c" responseTimeMS=11 responseBytes=2728154 userAgent=""
2025-09-02T09:23:42Z clientIP="103.213.96.36" requestID="069ebb2f-cb8d-4df1" responseTimeMS=111 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:42.132839702Z 2025-09-02 09:23:42,132 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172748s
2025-09-02T09:23:42.132867243Z 2025-09-02 09:23:42,132 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172748s
2025-09-02T09:23:42.133444584Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:42.502530172Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:42.836482121Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:43Z clientIP="113.68.252.164" requestID="713995a4-c980-40e6" responseTimeMS=10 responseBytes=2728154 userAgent=""
2025-09-02T09:23:43.867959119Z 2025-09-02 09:23:43,867 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172747s
2025-09-02T09:23:43.8680044Z 2025-09-02 09:23:43,867 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172747s
2025-09-02T09:23:43.868653312Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:46Z clientIP="113.68.252.164" requestID="0386f952-7319-4e03" responseTimeMS=11 responseBytes=2728154 userAgent=""
2025-09-02T09:23:46.878055582Z 2025-09-02 09:23:46,877 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172744s
2025-09-02T09:23:46.878085743Z 2025-09-02 09:23:46,877 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172744s
2025-09-02T09:23:46.878675044Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:48Z clientIP="113.68.252.164" requestID="b712b6c4-348d-4c19" responseTimeMS=17 responseBytes=2728154 userAgent=""
2025-09-02T09:23:48.788651815Z 2025-09-02 09:23:48,787 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172742s
2025-09-02T09:23:48.78890421Z 2025-09-02 09:23:48,788 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172742s
2025-09-02T09:23:48.789716216Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:50Z clientIP="103.213.96.36" requestID="c66b0549-294d-461f" responseTimeMS=114 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:50Z clientIP="113.68.252.164" requestID="bcd1c3e7-211f-47f0" responseTimeMS=11 responseBytes=2728154 userAgent=""
2025-09-02T09:23:50.293226338Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:50.293226478Z 2025-09-02 09:23:50,291 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172740s
2025-09-02T09:23:50.293260469Z 2025-09-02 09:23:50,292 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172740s
2025-09-02T09:23:50.757659172Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:51Z clientIP="103.213.96.36" requestID="1a8f5204-c97b-4401" responseTimeMS=110 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:23:51Z clientIP="103.213.96.36" requestID="f5a86f5e-1c8a-4b2d" responseTimeMS=107 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:23:51.291786712Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:23:51.928588712Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:23:53Z clientIP="113.68.252.164" requestID="21ff609e-b7df-4a06" responseTimeMS=14 responseBytes=2728154 userAgent=""
2025-09-02T09:23:53.091999654Z 2025-09-02 09:23:53,091 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172737s
2025-09-02T09:23:53.092096646Z 2025-09-02 09:23:53,091 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172737s
2025-09-02T09:23:53.093100936Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:23:56Z clientIP="113.68.252.164" requestID="2e0a0a15-c2fc-4bb1" responseTimeMS=37 responseBytes=2728154 userAgent=""
2025-09-02T09:23:56.796352904Z 2025-09-02 09:23:56,796 - backend.services.file_service - INFO - Token validated successfully for order-session_1756804936-final-1756804936-de84ed97.png, partner: chinese_manufacturing, time remaining: 172734s
2025-09-02T09:23:56.796435426Z 2025-09-02 09:23:56,796 - api_routes - INFO - Image access granted for: order-session_1756804936-final-1756804936-de84ed97.png from IP: 113.68.252.164, partner: chinese_manufacturing, time remaining: 172734s
2025-09-02T09:23:56.796915046Z INFO:     113.68.252.164:0 - "GET /image/order-session_1756804936-final-1756804936-de84ed97.png?token=1756977770:chinese_manufacturing:31245d225e40ab8d222c494cc1a7d11e126f197cdde2edc58457731967b0001f HTTP/1.1" 200 OK
2025-09-02T09:24:05Z clientIP="103.213.96.36" requestID="d538a587-3c73-4f33" responseTimeMS=108 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:05.088715712Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:06Z clientIP="103.213.96.36" requestID="8598a2aa-2721-448b" responseTimeMS=110 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:06.967415623Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:07.605491469Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:07Z clientIP="103.213.96.36" requestID="9500b8a8-2bbe-4390" responseTimeMS=117 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:11Z clientIP="103.213.96.36" requestID="d60ebd69-081c-4aa4" responseTimeMS=177 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:11Z clientIP="103.213.96.36" requestID="285f378f-8e18-4f27" responseTimeMS=160 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:11.135253183Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:11.1621168Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:12Z clientIP="103.213.96.36" requestID="94d7f485-c5b3-476a" responseTimeMS=110 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:12.559694039Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:21Z clientIP="103.213.96.36" requestID="f3f527e1-edf1-4bc5" responseTimeMS=232 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:21Z clientIP="103.213.96.36" requestID="6f58a34f-558f-4a1f" responseTimeMS=193 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:21.167410781Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:21.212422073Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:22Z clientIP="103.213.96.36" requestID="dd8426e3-1ba3-4afc" responseTimeMS=107 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:22.929100532Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:30Z clientIP="103.213.96.36" requestID="90748ed1-d96c-4f19" responseTimeMS=118 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:30.990312858Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:31Z clientIP="103.213.96.36" requestID="ecc3ffdb-e979-4bbe" responseTimeMS=120 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:31.22377124Z 2025-09-02 09:24:31,223 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:24:31.34428761Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:32Z clientIP="103.213.96.36" requestID="15e95ee0-b707-49bb" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:32.492524328Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:44Z clientIP="103.213.96.36" requestID="61b51fde-d0f0-4438" responseTimeMS=169 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:44.855400718Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:45Z clientIP="103.213.96.36" requestID="9da1eda3-05ca-466b" responseTimeMS=133 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:45.049251954Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:48Z clientIP="103.213.96.36" requestID="11c809ad-c972-4b0d" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:24:48.932919739Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:24:50Z clientIP="103.213.96.36" requestID="62a71e1d-e139-4c9e" responseTimeMS=122 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:24:50.958352459Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:24:58Z clientIP="223.160.225.168" requestID="63a8478f-fa04-4017" responseTimeMS=3 responseBytes=575 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:24:58Z clientIP="223.160.225.168" requestID="799546f2-888d-4235" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:24:58.194268084Z 2025-09-02 09:24:58,194 - backend.services.chinese_payment_service - INFO - Cache HIT for brand_list
2025-09-02T09:24:58.194744623Z Starting get_brands API call
2025-09-02T09:24:58.194752063Z Device ID received: 1517Y7PU1RF3
2025-09-02T09:24:58.194755843Z Successfully fetched 10 brands from Chinese API
2025-09-02T09:24:58.194759203Z INFO:     223.160.225.168:0 - "GET /api/brands?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:24:58.201514915Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/register-user HTTP/1.1" 200 OK
2025-09-02T09:24:59.302165863Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:24:59.302213664Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:24:59.302220725Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR20250111000002'}: 17a9409959e9bf1d11ece5aab7997ea0
2025-09-02T09:24:59.302226165Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': [{'mobile_shell_id': 'MS102503270001', 'mobile_model_name': 'iPhone 15', 'width': '76.28', 'stock': 7, 'mobile_model_id': 'MM020250224000008', 'height': '151.72'}, {'mobile_shell_id': 'MS102503280004', 'mobile_model_name': 'iPhone 16 Pro Max', 'width': '80.52', 'stock': 6, 'mobile_model_id': 'MM1020250226000002', 'height': '166.03'}]}
2025-09-02T09:24:59.302230535Z INFO:     223.160.225.168:0 - "GET /api/brands/iphone/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:24:59.546420568Z === REGISTER USER WITH SESSION START ===
2025-09-02T09:24:59.546454398Z Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:24:59.546463298Z Request: {'machine_id': '1517Y7PU1RF3', 'session_id': '1517Y7PU1RF3_20250902_091645_838045D7', 'location': None, 'user_agent': 'Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36', 'ip_address': None}
2025-09-02T09:24:59.546467898Z Successfully registered user with session:
2025-09-02T09:24:59.546472129Z - Session ID: 1517Y7PU1RF3_20250902_091645_838045D7
2025-09-02T09:24:59.546477649Z - Machine: 1517Y7PU1RF3
2025-09-02T09:24:59.546481999Z - User Progress: qr_scanned
2025-09-02T09:24:59.546485569Z === REGISTER USER WITH SESSION END ===
2025-09-02T09:24:59.546489379Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/register-user HTTP/1.1" 200 OK
2025-09-02T09:24:59Z clientIP="223.160.225.168" requestID="c8c35845-7534-4f61" responseTimeMS=650 responseBytes=589 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:24:59Z clientIP="223.160.225.168" requestID="302c92c9-6a42-441f" responseTimeMS=622 responseBytes=510 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:25:00Z clientIP="223.160.225.168" requestID="b59d401f-71d2-40be" responseTimeMS=470 responseBytes=439 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:25:00.684958918Z Generated signature for params {}: e3d312ec208de5f1c32c8c6850116b1e
2025-09-02T09:25:00.684991888Z Chinese API response for brand/list: {'msg': '操作成功', 'code': 200, 'data': [{'e_name': '测试品牌', 'name': '测试品牌', 'id': 'BR102507260001'}, {'e_name': 'jiuyun', 'name': '玖云', 'id': 'BR102508200001'}, {'e_name': 'Apple', 'name': '苹果', 'id': 'BR20250111000002'}, {'e_name': 'SAMSUNG', 'name': '三星', 'id': 'BR020250120000001'}, {'e_name': 'HUAWEI', 'name': '华为', 'id': 'BR102504010001'}, {'e_name': 'Redmi', 'name': '红米', 'id': 'BR102504060001'}, {'e_name': 'OPPO', 'name': 'OPPO', 'id': 'BR102504020001'}, {'e_name': 'VIVO', 'name': 'VIVO', 'id': 'BR102504020002'}, {'e_name': 'Xiaomi', 'name': '小米', 'id': 'BR20250111000001'}, {'e_name': 'HONOR', 'name': '荣耀', 'id': 'BR102504070001'}]}
2025-09-02T09:25:00.685011239Z Generated signature for params {'device_id': '1517Y7PU1RF3', 'brand_id': 'BR020250120000001'}: eb5f4a668fee97b77dad3b69ed5cf098
2025-09-02T09:25:00.685014229Z Chinese API response for stock/list: {'msg': '操作成功', 'code': 200, 'data': []}
2025-09-02T09:25:00.685017099Z INFO:     223.160.225.168:0 - "GET /api/brands/samsung/models?device_id=1517Y7PU1RF3 HTTP/1.1" 200 OK
2025-09-02T09:25:01Z clientIP="103.213.96.36" requestID="707bf21b-20d7-4da8" responseTimeMS=108 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:01Z clientIP="103.213.96.36" requestID="e6d59a39-1f72-4171" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:01.349995774Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:01.508290304Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:02Z clientIP="103.213.96.36" requestID="d32e9642-d575-4c93" responseTimeMS=107 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:02.774524725Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:10Z clientIP="103.213.96.36" requestID="408ff5a1-4f05-4cc4" responseTimeMS=116 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:10.773819918Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:11Z clientIP="103.213.96.36" requestID="ecca30da-9f15-4755" responseTimeMS=236 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:11.314308014Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:15Z clientIP="103.213.96.36" requestID="03a9ad2a-c7a3-44f6" responseTimeMS=118 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:15.221584148Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:26Z clientIP="103.213.96.36" requestID="3e05c062-7606-4798" responseTimeMS=223 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:26Z clientIP="103.213.96.36" requestID="17fec9b1-a8ac-4342" responseTimeMS=250 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:26.300814716Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:26.353757273Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:27Z clientIP="103.213.96.36" requestID="18eab4fd-24a3-48ad" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:27.729236926Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:32Z clientIP="103.213.96.36" requestID="b902c20c-21f2-4fd5" responseTimeMS=116 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:32.630293921Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:33Z clientIP="103.213.96.36" requestID="935ae82e-c6da-4e35" responseTimeMS=122 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:33.433506755Z 2025-09-02 09:25:33,433 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:25:33.553307822Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:34Z clientIP="103.213.96.36" requestID="46151281-22f1-4137" responseTimeMS=109 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:34.405200949Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:41Z clientIP="103.213.96.36" requestID="cd673fa4-033d-4686" responseTimeMS=175 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:41Z clientIP="103.213.96.36" requestID="0bc7057d-5a0e-4eaf" responseTimeMS=321 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:41.039740342Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:41.068920164Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:42Z clientIP="103.213.96.36" requestID="001ac49a-0fe5-4770" responseTimeMS=115 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:42.639685844Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:50Z clientIP="103.213.96.36" requestID="29eff1e2-872b-4600" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:50.864984874Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:25:51Z clientIP="103.213.96.36" requestID="cc702a9c-43d0-4610" responseTimeMS=109 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:25:51.163774747Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:25:52Z clientIP="103.213.96.36" requestID="46e7094e-b45b-492f" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:25:52.541492256Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:01.523801711Z 2025-09-02 09:26:01,523 - backend.services.file_service - INFO - Generated end_user token for order-session_1756805161-final-1756805161-f16bf22d.png with 1h expiry
2025-09-02T09:26:01.523829731Z 2025-09-02 09:26:01,523 - backend.services.file_service - INFO - Generated secure URL for order-session_1756805161-final-1756805161-f16bf22d.png, partner: end_user
2025-09-02T09:26:01.524452264Z 🔄 API - Upload final image request received
2025-09-02T09:26:01.524464964Z 🔄 API - template_id: classic
2025-09-02T09:26:01.524469894Z 🔄 API - order_id: None
2025-09-02T09:26:01Z clientIP="223.160.225.168" requestID="6691bf18-7396-4d00" responseTimeMS=11109 responseBytes=555 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:01.524475114Z 🔄 API - metadata: {"inputText":"","selectedFont":"Arial","fontSize":30,"selectedTextColor":"#ffffff","selectedBackgroundColor":"#ffffff","textPosition":{"x":50,"y":50},"uploadTimestamp":"2025-09-02T09:25:44.193Z"}
2025-09-02T09:26:01.524491054Z 🔄 API - final_image_data length: 4250122 chars
2025-09-02T09:26:01.524494644Z ✅ Image saved: order-session_1756805161-final-1756805161-f16bf22d.png (3187575 bytes)
2025-09-02T09:26:01.524497374Z 🔄 API - Final image saved: order-session_1756805161-final-1756805161-f16bf22d.png
2025-09-02T09:26:01.524500925Z 🔄 API - Public URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756808761:end_user:59a740afa3fcf7625fc9dbda9a14a624391feb36d31440ba4b71d64a49d17a37
2025-09-02T09:26:01.524504194Z INFO:     223.160.225.168:0 - "POST /api/images/upload-final HTTP/1.1" 200 OK
2025-09-02T09:26:02Z clientIP="223.160.225.168" requestID="401447ff-f9a8-4576" responseTimeMS=33 responseBytes=3187920 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:02.110887872Z 2025-09-02 09:26:02,110 - backend.services.file_service - INFO - Token validated successfully for order-session_1756805161-final-1756805161-f16bf22d.png, partner: end_user, time remaining: 3599s
2025-09-02T09:26:02.110914002Z 2025-09-02 09:26:02,110 - api_routes - INFO - Image access granted for: order-session_1756805161-final-1756805161-f16bf22d.png from IP: 223.160.225.168, partner: end_user, time remaining: 3599s
2025-09-02T09:26:02.111405142Z INFO:     223.160.225.168:0 - "GET /image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756808761:end_user:59a740afa3fcf7625fc9dbda9a14a624391feb36d31440ba4b71d64a49d17a37 HTTP/1.1" 200 OK
2025-09-02T09:26:05Z clientIP="103.213.96.36" requestID="201711ef-d66e-4182" responseTimeMS=156 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:05Z clientIP="223.160.225.168" requestID="133de0b7-57e0-4708" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:05Z clientIP="103.213.96.36" requestID="9264813d-c3f4-4bd4" responseTimeMS=190 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:05.215002123Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:05.257475395Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:05.66150706Z INFO:     223.160.225.168:0 - "OPTIONS /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-summary HTTP/1.1" 200 OK
2025-09-02T09:26:06Z clientIP="103.213.96.36" requestID="f2760b88-5437-4614" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:06.986521758Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:10Z clientIP="103.213.96.36" requestID="3a5808b1-dde8-40d9" responseTimeMS=169 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:10Z clientIP="103.213.96.36" requestID="33bb60e2-83db-44fd" responseTimeMS=175 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:10.954805691Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:10.981884661Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:12Z clientIP="103.213.96.36" requestID="8746141b-fd65-489e" responseTimeMS=113 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:12.455647614Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:13Z clientIP="223.160.225.168" requestID="2c5bd1c5-90bd-4f90" responseTimeMS=111 responseBytes=354 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:13.43752899Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-summary HTTP/1.1" 400 Bad Request
2025-09-02T09:26:20Z clientIP="103.213.96.36" requestID="4adf0293-4833-41fd" responseTimeMS=188 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:20Z clientIP="103.213.96.36" requestID="09a50050-9114-491d" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:20.881577699Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:20.905518288Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:23Z clientIP="103.213.96.36" requestID="e6189869-23dd-4e1f" responseTimeMS=115 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:23.89517494Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:26Z clientIP="223.160.225.168" requestID="7ed5a2dc-70bc-42c1" responseTimeMS=291 responseBytes=354 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:26.231812109Z INFO:     223.160.225.168:0 - "POST /api/vending/session/1517Y7PU1RF3_20250902_091645_838045D7/order-summary HTTP/1.1" 400 Bad Request
2025-09-02T09:26:30Z clientIP="223.160.225.168" requestID="c23c4718-7e5c-401a" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:30.274871961Z INFO:     223.160.225.168:0 - "OPTIONS /api/chinese/order/payData HTTP/1.1" 200 OK
2025-09-02T09:26:30.773356797Z 2025-09-02 09:26:30,772 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST START (BACKEND_1756805190) ===
2025-09-02T09:26:30.773378948Z 2025-09-02 09:26:30,773 - backend.routes.chinese_api - INFO - Client IP: 223.160.225.168
2025-09-02T09:26:30.773418829Z 2025-09-02 09:26:30,773 - backend.routes.chinese_api - INFO - Request payload: {'mobile_model_id': 'MM1020250226000002', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902347363', 'pay_amount': 19.99, 'pay_type': 12}
2025-09-02T09:26:30.773424739Z 2025-09-02 09:26:30,773 - backend.routes.chinese_api - INFO - Timestamp: 2025-09-02T09:26:30.773331+00:00
2025-09-02T09:26:30.854693451Z 2025-09-02 09:26:30,854 - backend.routes.chinese_api - INFO - Found mobile model: iPhone 16 Pro Max (chinese_id: MM1020250226000002)
2025-09-02T09:26:30.854880015Z 2025-09-02 09:26:30,854 - backend.routes.chinese_api - INFO - Payment record: {
2025-09-02T09:26:30.854886815Z   "correlation_id": "BACKEND_1756805190",
2025-09-02T09:26:30.854889295Z   "third_id": "PYEN250902347363",
2025-09-02T09:26:30.854892125Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:26:30.854894305Z   "mobile_model_id": "MM1020250226000002",
2025-09-02T09:26:30.854896985Z   "pay_amount": 19.99,
2025-09-02T09:26:30.854899125Z   "pay_type": 12,
2025-09-02T09:26:30.854902405Z   "initiated_at": "2025-09-02T09:26:30.854654+00:00",
2025-09-02T09:26:30.854904585Z   "client_ip": "223.160.225.168"
2025-09-02T09:26:30.854906615Z }
2025-09-02T09:26:30.854917535Z 2025-09-02 09:26:30,854 - backend.routes.chinese_api - INFO - Calling Chinese payment service...
2025-09-02T09:26:30.855018628Z 2025-09-02 09:26:30,854 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE START ===
2025-09-02T09:26:30.855073398Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:26:30.85515224Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Payment details: third_id=PYEN250902347363, amount=19.99, pay_type=12
2025-09-02T09:26:30.855247242Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM1020250226000002
2025-09-02T09:26:30.855375244Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Device ID: 1517Y7PU1RF3
2025-09-02T09:26:30.855390475Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:26:30.855519977Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Authentication successful in 0.00s, token: eyJhbGciOiJIUzUxMiJ9...
2025-09-02T09:26:30.855579699Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - === PAYLOAD TO CHINESE API ===
2025-09-02T09:26:30.85567621Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:26:30.855681261Z   "mobile_model_id": "MM1020250226000002",
2025-09-02T09:26:30.85568465Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:26:30.855687811Z   "third_id": "PYEN250902347363",
2025-09-02T09:26:30.855690651Z   "pay_amount": 19.99,
2025-09-02T09:26:30.855692461Z   "pay_type": 12
2025-09-02T09:26:30.855694471Z }
2025-09-02T09:26:30.855723431Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Generating signature...
2025-09-02T09:26:30.855839484Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM102025022600000219.9912PYEN250902347363mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:26:30.855938315Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - DEBUG - Generated signature: 169e02c318e29d8288db8f277141c45c
2025-09-02T09:26:30.856033267Z 2025-09-02 09:26:30,855 - backend.services.chinese_payment_service - INFO - Signature generated in 0.000s: 169e02c318e29d8288db8f277141c45c
2025-09-02T09:26:30.856066648Z 2025-09-02 09:26:30,856 - backend.services.chinese_payment_service - INFO - === REQUEST HEADERS ===
2025-09-02T09:26:30.856218721Z 2025-09-02 09:26:30,856 - backend.services.chinese_payment_service - INFO - Headers: {
2025-09-02T09:26:30.856229501Z   "Authorization": "eyJhbGciOiJIUzUxMiJ9...",
2025-09-02T09:26:30.856232531Z   "sign": "169e02c318e29d8288db8f277141c45c",
2025-09-02T09:26:30.856341403Z   "req_source": "en",
2025-09-02T09:26:30.856344983Z   "Content-Type": "application/json",
2025-09-02T09:26:30.856347363Z   "User-Agent": "PimpMyCase-API/2.0.0"
2025-09-02T09:26:30.856353054Z }
2025-09-02T09:26:30.856362094Z 2025-09-02 09:26:30,856 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payData
2025-09-02T09:26:31.500708948Z 2025-09-02 09:26:31,500 - backend.services.chinese_payment_service - INFO - HTTP request completed in 0.64s
2025-09-02T09:26:31.500787009Z 2025-09-02 09:26:31,500 - backend.services.chinese_payment_service - INFO - === CHINESE API HTTP RESPONSE ===
2025-09-02T09:26:31.501218738Z 2025-09-02 09:26:31,500 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:26:31.501229458Z 2025-09-02 09:26:31,500 - backend.services.chinese_payment_service - INFO - Response headers: {'Vary': 'Origin, Access-Control-Request-Method, Access-Control-Request-Headers', 'tlogTraceId': '/mobileShell/en/order/payData20250902172631366b8622yqy', 'X-Content-Type-Options': 'nosniff', 'X-XSS-Protection': '1; mode=block', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': '0', 'Content-Type': 'application/json;charset=UTF-8', 'Transfer-Encoding': 'chunked', 'Date': 'Tue, 02 Sep 2025 09:26:31 GMT', 'Keep-Alive': 'timeout=60', 'Connection': 'keep-alive'}
2025-09-02T09:26:31.501232768Z 2025-09-02 09:26:31,500 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:26:31.501235668Z   "msg": "操作成功",
2025-09-02T09:26:31.501237948Z   "code": 200,
2025-09-02T09:26:31.501240248Z   "data": {
2025-09-02T09:26:31.501243158Z     "id": "MSPY10250902000007",
2025-09-02T09:26:31.501245878Z     "third_id": "PYEN250902347363"
2025-09-02T09:26:31.501248309Z   }
2025-09-02T09:26:31.501250658Z }
2025-09-02T09:26:31.501253478Z 2025-09-02 09:26:31,501 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment data sent successfully!
2025-09-02T09:26:31.501255779Z 2025-09-02 09:26:31,501 - backend.services.chinese_payment_service - INFO - Chinese Payment ID: MSPY10250902000007
2025-09-02T09:26:31.50130461Z 2025-09-02 09:26:31,501 - backend.services.chinese_payment_service - INFO - Third ID: PYEN250902347363
2025-09-02T09:26:31.50132058Z 2025-09-02 09:26:31,501 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT SERVICE END (SUCCESS) ===
2025-09-02T09:26:31.501547214Z 2025-09-02 09:26:31,501 - backend.routes.chinese_api - INFO - Chinese API call completed in 0.65s
2025-09-02T09:26:31.501552784Z 2025-09-02 09:26:31,501 - backend.routes.chinese_api - INFO - === CHINESE API RESPONSE (BACKEND_1756805190) ===
2025-09-02T09:26:31.501625276Z 2025-09-02 09:26:31,501 - backend.routes.chinese_api - INFO - Response: {
2025-09-02T09:26:31Z clientIP="103.213.96.36" requestID="33dc6457-5a37-4882" responseTimeMS=556 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:31Z clientIP="103.213.96.36" requestID="c2e82d4b-cd82-4722" responseTimeMS=880 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:31Z clientIP="223.160.225.168" requestID="a91bb5f0-3662-4457" responseTimeMS=793 responseBytes=393 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:31.501629286Z   "msg": "操作成功",
2025-09-02T09:26:31.501631926Z   "code": 200,
2025-09-02T09:26:31.501634526Z   "data": {
2025-09-02T09:26:31.501637056Z     "id": "MSPY10250902000007",
2025-09-02T09:26:31.501640336Z     "third_id": "PYEN250902347363"
2025-09-02T09:26:31.501642816Z   }
2025-09-02T09:26:31.501644976Z }
2025-09-02T09:26:31.501650336Z 2025-09-02 09:26:31,501 - backend.routes.chinese_api - INFO - SUCCESS: Payment data sent successfully to Chinese API
2025-09-02T09:26:31.501752188Z 2025-09-02 09:26:31,501 - backend.routes.chinese_api - INFO - Chinese Payment ID: MSPY10250902000007
2025-09-02T09:26:31.560957998Z 2025-09-02 09:26:31,560 - backend.routes.chinese_api - INFO - Stored payment mapping in PaymentMapping table: PYEN250902347363 -> MSPY10250902000007
2025-09-02T09:26:31.560997219Z 2025-09-02 09:26:31,560 - backend.routes.chinese_api - INFO - Mapped payment third_id PYEN250902347363 -> Chinese payment id MSPY10250902000007
2025-09-02T09:26:31.561094981Z 2025-09-02 09:26:31,561 - backend.routes.chinese_api - INFO - === CHINESE API PAYDATA REQUEST END (BACKEND_1756805190) ===
2025-09-02T09:26:31.563711542Z INFO:     223.160.225.168:0 - "POST /api/chinese/order/payData HTTP/1.1" 200 OK
2025-09-02T09:26:31.752784647Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:31.753155204Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:32Z clientIP="223.160.225.168" requestID="89ad8fe9-45a1-4fe2" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:32Z clientIP="223.160.225.168" requestID="578ddddc-48d9-4ffe" responseTimeMS=370 responseBytes=657 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:26:32.078702262Z INFO:     223.160.225.168:0 - "OPTIONS /create-checkout-session HTTP/1.1" 200 OK
2025-09-02T09:26:32.570560869Z 2025-09-02 09:26:32,570 - stripe - INFO - message='Request to Stripe api' method=post path=https://api.stripe.com/v1/checkout/sessions
2025-09-02T09:26:32.937239123Z 2025-09-02 09:26:32,936 - stripe - INFO - message='Stripe API response' path=https://api.stripe.com/v1/checkout/sessions response_code=200
2025-09-02T09:26:32.937971467Z Payment amount: 19.99£ (1999 pence)
2025-09-02T09:26:32.937977897Z INFO:     223.160.225.168:0 - "POST /create-checkout-session HTTP/1.1" 200 OK
2025-09-02T09:26:33Z clientIP="103.213.96.36" requestID="635aceae-d52a-4add" responseTimeMS=111 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:33.225109783Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:45Z clientIP="103.213.96.36" requestID="b8ef36df-5c38-4aef" responseTimeMS=170 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:45Z clientIP="103.213.96.36" requestID="6b4478f2-c492-4856" responseTimeMS=185 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:45.782726121Z 2025-09-02 09:26:45,782 - backend.routes.chinese_api - INFO - Chinese team polling payment status: PYEN250902218281 (log noise reduced)
2025-09-02T09:26:45.86488105Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:45.891552163Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:47Z clientIP="103.213.96.36" requestID="4e3e64ce-da38-4c9f" responseTimeMS=111 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:47Z clientIP="103.213.96.36" requestID="c5062f49-124f-40b2" responseTimeMS=110 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:47.164220468Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:47.333787641Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:51Z clientIP="103.213.96.36" requestID="ef6d8862-20e6-42ff" responseTimeMS=110 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:51.191887513Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:52Z clientIP="103.213.96.36" requestID="6cb714dd-d801-4f6d" responseTimeMS=109 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:52Z clientIP="103.213.96.36" requestID="178ccdb0-7e77-4478" responseTimeMS=109 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:26:52.215622872Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:26:52.772148666Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:26:53Z clientIP="103.213.96.36" requestID="4253e221-5c16-4833" responseTimeMS=108 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:26:53.615516891Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:27:01Z clientIP="103.213.96.36" requestID="74d2c0fb-b7fa-4d12" responseTimeMS=117 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:27:01.474906516Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:27:02Z clientIP="103.213.96.36" requestID="399052ea-9e75-46d6" responseTimeMS=117 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:27:02.519551175Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:27:03Z clientIP="103.213.96.36" requestID="80d68497-31ff-4695" responseTimeMS=112 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:27:03.286158046Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:27:03Z clientIP="103.213.96.36" requestID="410c2e09-0c4d-4a45" responseTimeMS=111 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:27:03.863113601Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:27:06Z clientIP="3.18.12.63" requestID="24e81fa8-505f-4b3e" responseTimeMS=3 responseBytes=244 userAgent="Stripe/1.0 (+https://stripe.com/docs/webhooks)"
2025-09-02T09:27:06Z clientIP="52.15.183.38" requestID="4560c31d-9ce7-4258" responseTimeMS=3 responseBytes=246 userAgent="Stripe/1.0 (+https://stripe.com/docs/webhooks)"
2025-09-02T09:27:06.484041216Z Stripe webhook received: payment_intent.succeeded
2025-09-02T09:27:06.484073817Z Payment intent succeeded: pi_3S2qUXP7sQmXV4Gu118vnEnD
2025-09-02T09:27:06.484080506Z INFO:     3.18.12.63:0 - "POST /stripe-webhook HTTP/1.1" 200 OK
2025-09-02T09:27:06.566546133Z Stripe webhook received: checkout.session.completed
2025-09-02T09:27:06.566571173Z Payment successful for session: cs_test_a1tYpsjcEeR57AEGCSRZV2GJN9cpbnmFheX2GTnkVZ3pSmerUZrdTVbVNQ
2025-09-02T09:27:06.566577883Z INFO:     52.15.183.38:0 - "POST /stripe-webhook HTTP/1.1" 200 OK
2025-09-02T09:27:11Z clientIP="103.213.96.36" requestID="5ef5e77d-a2e9-45ab" responseTimeMS=165 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:27:11Z clientIP="103.213.96.36" requestID="50dcf4f6-d5de-4a50" responseTimeMS=133 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:27:11.182256425Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:27:11.209023179Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found
2025-09-02T09:27:13Z clientIP="223.160.225.168" requestID="bc143a33-2ba5-4fad" responseTimeMS=1 responseBytes=648 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:27:13Z clientIP="103.213.96.36" requestID="83769893-8aa9-4eea" responseTimeMS=111 responseBytes=426 userAgent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)"
2025-09-02T09:27:13.002054513Z INFO:     103.213.96.36:0 - "GET /api/chinese/payment/PYEN250902218281/status HTTP/1.1" 200 OK
2025-09-02T09:27:13.320501183Z INFO:     223.160.225.168:0 - "OPTIONS /process-payment-success HTTP/1.1" 200 OK
2025-09-02T09:27:13.762256829Z 2025-09-02 09:27:13,762 - stripe - INFO - message='Request to Stripe api' method=get path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1tYpsjcEeR57AEGCSRZV2GJN9cpbnmFheX2GTnkVZ3pSmerUZrdTVbVNQ
2025-09-02T09:27:13.900245933Z 2025-09-02 09:27:13,900 - stripe - INFO - message='Stripe API response' path=https://api.stripe.com/v1/checkout/sessions/cs_test_a1tYpsjcEeR57AEGCSRZV2GJN9cpbnmFheX2GTnkVZ3pSmerUZrdTVbVNQ response_code=200
2025-09-02T09:27:14.183766098Z 2025-09-02 09:27:14,183 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT STATUS NOTIFICATION START ===
2025-09-02T09:27:14.183795969Z 2025-09-02 09:27:14,183 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/payStatus
2025-09-02T09:27:14.183898781Z 2025-09-02 09:27:14,183 - backend.services.chinese_payment_service - INFO - Payment status details: third_id=PYEN250902347363, status=3, amount=19.99
2025-09-02T09:27:14.183967312Z 2025-09-02 09:27:14,183 - backend.services.chinese_payment_service - INFO - Checking authentication status...
2025-09-02T09:27:14.184010243Z 2025-09-02 09:27:14,183 - backend.services.chinese_payment_service - INFO - === PAYMENT STATUS PAYLOAD ===
2025-09-02T09:27:14.184163006Z 2025-09-02 09:27:14,184 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:27:14.184170216Z   "third_id": "PYEN250902347363",
2025-09-02T09:27:14.184174296Z   "status": 3,
2025-09-02T09:27:14.184179356Z   "pay_amount": 19.99
2025-09-02T09:27:14.184206487Z }
2025-09-02T09:27:14.184276498Z 2025-09-02 09:27:14,184 - backend.services.chinese_payment_service - DEBUG - Signature string: 19.993PYEN250902347363mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:27:14.18434616Z 2025-09-02 09:27:14,184 - backend.services.chinese_payment_service - DEBUG - Generated signature: 73ad19b85b3a975417c1a8d5af2fd0c9
2025-09-02T09:27:14.184406791Z 2025-09-02 09:27:14,184 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/payStatus
2025-09-02T09:27:14.410251736Z 2025-09-02 09:27:14,409 - backend.services.chinese_payment_service - INFO - Payment status request completed in 0.23s
2025-09-02T09:27:14.410272167Z 2025-09-02 09:27:14,409 - backend.services.chinese_payment_service - INFO - === CHINESE API PAYMENT STATUS RESPONSE ===
2025-09-02T09:27:14.410277107Z 2025-09-02 09:27:14,409 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:27:14.410281317Z 2025-09-02 09:27:14,410 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:27:14.410286157Z   "msg": "操作成功",
2025-09-02T09:27:14.410290257Z   "code": 200
2025-09-02T09:27:14.410294147Z }
2025-09-02T09:27:14.410654494Z 2025-09-02 09:27:14,410 - backend.services.chinese_payment_service - INFO - SUCCESS: Payment status sent successfully!
2025-09-02T09:27:14.410666784Z 2025-09-02 09:27:14,410 - backend.services.chinese_payment_service - INFO - === CHINESE PAYMENT STATUS NOTIFICATION END (SUCCESS) ===
2025-09-02T09:27:14.410671304Z 2025-09-02 09:27:14,410 - backend.services.file_service - INFO - Generated chinese_manufacturing token for order-session_1756805161-final-1756805161-f16bf22d.png with 48h expiry
2025-09-02T09:27:14.450803551Z 2025-09-02 09:27:14,450 - backend.routes.chinese_api - INFO - Found payment mapping in PaymentMapping table: PYEN250902347363 -> MSPY10250902000007
2025-09-02T09:27:14.450837002Z 2025-09-02 09:27:14,450 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION START ===
2025-09-02T09:27:14.450967714Z 2025-09-02 09:27:14,450 - backend.services.chinese_payment_service - INFO - Target URL: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:27:14.450988765Z 2025-09-02 09:27:14,450 - backend.services.chinese_payment_service - INFO - Order details: third_pay_id=PYEN250902347363, third_id=OREN250902805234
2025-09-02T09:27:14.451056296Z 2025-09-02 09:27:14,450 - backend.services.chinese_payment_service - INFO - Mobile model ID: MM1020250226000002, device_id: 1517Y7PU1RF3
2025-09-02T09:27:14.451073396Z 2025-09-02 09:27:14,451 - backend.services.chinese_payment_service - INFO - Mobile shell ID: MS102503280004
2025-09-02T09:27:14.451141868Z 2025-09-02 09:27:14,451 - backend.services.chinese_payment_service - INFO - Design image URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69
2025-09-02T09:27:14.451209089Z 2025-09-02 09:27:14,451 - backend.services.chinese_payment_service - INFO - Waiting 3 seconds for Chinese API to process payment before sending order data...
2025-09-02T09:27:17.451467948Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - 3-second delay completed, proceeding with order data submission
2025-09-02T09:27:17.451609611Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - 🔒 PRESERVING authentication tokens in URL for Chinese API access
2025-09-02T09:27:17.451676472Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - Full authenticated URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69
2025-09-02T09:27:17.451737564Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - ✅ URL contains required authentication token
2025-09-02T09:27:17.451835756Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - ✅ Token validation passed: 1 token parameter
2025-09-02T09:27:17.451900697Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - ✅ Using AUTHENTICATED URL for Chinese API (NOT shortened): https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69
2025-09-02T09:27:17.451975898Z 2025-09-02 09:27:17,451 - backend.services.chinese_payment_service - INFO - === ORDER DATA PAYLOAD ===
2025-09-02T09:27:17.452079471Z 2025-09-02 09:27:17,452 - backend.services.chinese_payment_service - INFO - Request payload: {
2025-09-02T09:27:17.45208606Z   "third_pay_id": "PYEN250902347363",
2025-09-02T09:27:17.452089001Z   "third_id": "OREN250902805234",
2025-09-02T09:27:17.452091311Z   "mobile_model_id": "MM1020250226000002",
2025-09-02T09:27:17.452093911Z   "pic": "https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69",
2025-09-02T09:27:17.452096611Z   "device_id": "1517Y7PU1RF3",
2025-09-02T09:27:17.452098821Z   "mobile_shell_id": "MS102503280004"
2025-09-02T09:27:17.452100971Z }
2025-09-02T09:27:17.452109741Z 2025-09-02 09:27:17,452 - backend.services.chinese_payment_service - DEBUG - Signature string: 1517Y7PU1RF3MM1020250226000002MS102503280004https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69OREN250902805234PYEN250902347363mobileShellshfoa3sfwoehnf3290rqefiz4efd
2025-09-02T09:27:17.452219263Z 2025-09-02 09:27:17,452 - backend.services.chinese_payment_service - DEBUG - Generated signature: 2d9983bd14e511dad41de0f42b475f82
2025-09-02T09:27:17.452286475Z 2025-09-02 09:27:17,452 - backend.services.chinese_payment_service - INFO - Making POST request to: http://app-dev.deligp.com:8500/mobileShell/en/order/orderData
2025-09-02T09:27:17.767546482Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - Order data request completed in 0.32s
2025-09-02T09:27:17.767610093Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - === CHINESE API ORDER DATA RESPONSE ===
2025-09-02T09:27:17.767673364Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - HTTP Status: 200 
2025-09-02T09:27:17.767795557Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - Response body: {
2025-09-02T09:27:17.767800107Z   "msg": "操作成功",
2025-09-02T09:27:17.767802477Z   "code": 200,
2025-09-02T09:27:17.767804747Z   "data": {
2025-09-02T09:27:17.767807717Z     "id": "MSOR10250902000005",
2025-09-02T09:27:17.767810487Z     "third_id": "OREN250902805234",
2025-09-02T09:27:17.767812467Z     "queue_no": "9578",
2025-09-02T09:27:17.767814587Z     "status": 4
2025-09-02T09:27:17.767816627Z   }
2025-09-02T09:27:17.767818787Z }
2025-09-02T09:27:17.767853428Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - SUCCESS: Order data sent successfully!
2025-09-02T09:27:17.767914869Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - Chinese Order ID: MSOR10250902000005
2025-09-02T09:27:17.767990631Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - Queue Number: 9578
2025-09-02T09:27:17.768038572Z 2025-09-02 09:27:17,767 - backend.services.chinese_payment_service - INFO - === CHINESE ORDER DATA SUBMISSION END (SUCCESS) ===
2025-09-02T09:27:17.988604924Z Starting payment processing for session: cs_test_a1tYpsjcEeR57AEGCSRZV2GJN9cpbnmFheX2GTnkVZ3pSmerUZrdTVbVNQ
2025-09-02T09:27:17.988636684Z Checkout session status: paid
2025-09-02T09:27:17.988640064Z Session amount: 1999
2025-09-02T09:27:17.988642314Z Session currency: gbp
2025-09-02T09:27:17.988646605Z === COMPLETE CHINESE API INTEGRATION START for order b56a6630-1f86-47e1-8cf1-5ad1345d43c7 ===
2025-09-02T09:27:17.988651945Z Payment method: app, has device_id: True, is_vending_payment: True
2025-09-02T09:27:17.988655215Z Payment data validation:
2025-09-02T09:27:17.988659145Z   - existing_third_id: PYEN250902347363
2025-09-02T09:27:17.988663005Z   - existing_chinese_payment_id: MSPY10250902000007
2025-09-02T09:27:17.988665905Z   - device_id: 1517Y7PU1RF3
2025-09-02T09:27:17.988668685Z   - chinese_model_id: MM1020250226000002
2025-09-02T09:27:17.988671425Z Chinese API integration: device_id=1517Y7PU1RF3, model_id=MM1020250226000002, third_id=PYEN250902347363
2025-09-02T09:27:17.988674515Z STEP 1: Sending payment data to Chinese API...
2025-09-02T09:27:17.988677535Z ✅ Payment data already sent by frontend with third_id: PYEN250902347363
2025-09-02T09:27:17Z clientIP="223.160.225.168" requestID="b9d93aa8-ddc3-405d" responseTimeMS=4228 responseBytes=504 userAgent="Mozilla/5.0 (Linux; U; Android 15; zh-CN; 23013RK75C Build/AQ3A.240912.001) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/123.0.6312.80 UCBrowser/18.0.4.1430 Mobile Safari/537.36"
2025-09-02T09:27:17.988680385Z STEP 2: Sending payment status notification to Chinese API...
2025-09-02T09:27:17.988683325Z Chinese API payStatus response: {'msg': '操作成功', 'code': 200}
2025-09-02T09:27:17.988686245Z SUCCESS: Payment status notification sent to Chinese API
2025-09-02T09:27:17.988689035Z STEP 3: Preparing order data for Chinese API...
2025-09-02T09:27:17.988692935Z ✅ Using existing permanent URL from pic field: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756808761:end_user:59a740afa3fcf7625fc9dbda9a14a624391feb36d31440ba4b71d64a49d17a37
2025-09-02T09:27:17.988696086Z 🔧 Extracted clean filename: order-session_1756805161-final-1756805161-f16bf22d.png
2025-09-02T09:27:17.988717426Z 🔧 CRITICAL FIX: Generating NEW secure URL with CLEAN filename
2025-09-02T09:27:17.988721086Z    Clean filename: order-session_1756805161-final-1756805161-f16bf22d.png
2025-09-02T09:27:17.988724276Z    Original URL had tokens: True
2025-09-02T09:27:17.988727416Z ✅ Generated CLEAN secure Chinese manufacturing token (48h)
2025-09-02T09:27:17.988731476Z    Original URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756808761:end_user:59a740afa3fcf7625fc9dbda9a14a624391feb36d31440ba4b71d64a49d17a37
2025-09-02T09:27:17.988735816Z    New Clean URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69
2025-09-02T09:27:17.988738746Z    Token count: 1 (correct)
2025-09-02T09:27:17.988745526Z Backend - Generated third_id (UTC): OREN250902805234
2025-09-02T09:27:17.988749347Z ✅ Using original third_id for orderData third_pay_id: PYEN250902347363
2025-09-02T09:27:17.988752476Z ℹ️ Chinese internal payment ID (for reference): MSPY10250902000007
2025-09-02T09:27:17.988756717Z DEBUG: Full order_data received: {'pic': 'https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756808761:end_user:59a740afa3fcf7625fc9dbda9a14a624391feb36d31440ba4b71d64a49d17a37', 'chinese_model_id': 'MM1020250226000002', 'mobile_model_id': 'MM1020250226000002', 'mobile_shell_id': 'MS102503280004', 'device_id': '1517Y7PU1RF3', 'third_id': 'PYEN250902347363', 'chinese_payment_id': 'MSPY10250902000007'}
2025-09-02T09:27:17.988760577Z ✅ Mobile shell ID extracted: MS102503280004
2025-09-02T09:27:17.988763797Z Sending order data: third_pay_id=PYEN250902347363 (Chinese ID), third_id=OREN250902805234
2025-09-02T09:27:17.988766837Z Original payment ID: PYEN250902347363
2025-09-02T09:27:17.988772217Z Design image URL: https://pimpmycase.onrender.com/image/order-session_1756805161-final-1756805161-f16bf22d.png?token=1756978034:chinese_manufacturing:b47a5ece0503669767dade78774323f0b523a535b86e025866fac6d3ca74ab69
2025-09-02T09:27:17.988775417Z Mobile shell ID: MS102503280004
2025-09-02T09:27:17.988778757Z ✅ Calling Chinese API orderData
2025-09-02T09:27:17.988782577Z Chinese API orderData response: {'msg': '操作成功', 'code': 200, 'data': {'id': 'MSOR10250902000005', 'third_id': 'OREN250902805234', 'queue_no': '9578', 'status': 4}}
2025-09-02T09:27:17.988785857Z SUCCESS: Order data sent to Chinese API for printing
2025-09-02T09:27:17.988789147Z ✅ Using Chinese API queue number: 9578
2025-09-02T09:27:17.988792257Z Successfully completed Chinese API integration
2025-09-02T09:27:17.988795517Z === COMPLETE CHINESE API INTEGRATION END ===
2025-09-02T09:27:17.988798848Z ✅ Final queue number from Chinese API: 9578
2025-09-02T09:27:17.988802017Z INFO:     223.160.225.168:0 - "POST /process-payment-success HTTP/1.1" 200 OK
2025-09-02T09:27:18Z clientIP="113.68.252.164" requestID="860b7a04-006b-424d" responseTimeMS=48 responseBytes=3187920 userAgent=""
2025-09-02T09:27:18Z clientIP="103.213.96.36" requestID="a94450a4-a74f-400d" responseTimeMS=3959 responseBytes=243 userAgent="Mozilla/5.0"
2025-09-02T09:27:18Z clientIP="113.68.252.164" requestID="0ef41ecb-9285-4320" responseTimeMS=33 responseBytes=3187920 userAgent=""
2025-09-02T09:27:18.016829407Z INFO:     103.213.96.36:0 - "POST /api/chinese/order-status-update HTTP/1.1" 404 Not Found