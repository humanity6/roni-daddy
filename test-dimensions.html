<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Case Dimensions Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-model {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 16px;
            margin: 16px 0;
            border-radius: 4px;
        }
        .test-model h3 {
            margin: 0 0 12px 0;
            color: #2c3e50;
        }
        .dimensions-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
        }
        .dimension-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .dimension-label {
            font-weight: bold;
            color: #666;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .summary {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            margin-top: 24px;
        }
        .run-tests-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .run-tests-btn:hover {
            background: #45a049;
        }
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📱 Phone Case Dimensions Integration Test</h1>
        
        <p>This test verifies that the Chinese API width/height dimensions are correctly processed for phone case printing.</p>
        
        <button class="run-tests-btn" onclick="runTests()">🧪 Run Dimension Tests</button>
        
        <div id="results-container"></div>
        <div id="console-output" class="console-output" style="display: none;"></div>
    </div>

    <script type="module">
        // Test data based on actual API responses
        const TEST_PHONE_MODELS = [
            {
                mobile_model_name: "iPhone 15 Pro",
                mobile_model_id: "MM020250224000010",
                width: "73.24",
                height: "149.27",
                mobile_shell_id: "MS102503270003"
            },
            {
                mobile_model_name: "iPhone 15 Pro Max", 
                mobile_model_id: "MM020250224000011",
                width: "79.5",
                height: "162.98", 
                mobile_shell_id: "MS102503270004"
            },
            {
                mobile_model_name: "SAMSUNG Galaxy S23Ultra",
                mobile_model_id: "MM020250221000003",
                width: "81.36",
                height: "167.47",
                mobile_shell_id: "MS102503310007"
            },
            {
                mobile_model_name: "SAMSUNG Galaxy S24Ultra",
                mobile_model_id: "MM020250221000004", 
                width: "76.28",
                height: "151.72",
                mobile_shell_id: "MS102503160006"
            },
            {
                mobile_model_name: "iPhone 12 mini",
                mobile_model_id: "MM1020250227000001",
                width: "68.58", 
                height: "135.97",
                mobile_shell_id: "MS102503290004"
            }
        ]

        function testCanvasDimensionsCalculation(phoneCaseDimensions) {
            const mmToInch = 0.0393701
            const dpi = 300
            
            const widthInches = phoneCaseDimensions.width * mmToInch
            const heightInches = phoneCaseDimensions.height * mmToInch
            
            const expectedWidth = Math.round(widthInches * dpi)
            const expectedHeight = Math.round(heightInches * dpi)
            
            return {
                input: phoneCaseDimensions,
                expectedCanvas: { width: expectedWidth, height: expectedHeight },
                calculations: {
                    widthInches: widthInches.toFixed(4),
                    heightInches: heightInches.toFixed(4),
                    aspectRatio: (phoneCaseDimensions.width / phoneCaseDimensions.height).toFixed(3)
                }
            }
        }

        function testContainerDimensionsCalculation(phoneCaseDimensions, scaleFactor = 4) {
            const expectedWidth = Math.round(phoneCaseDimensions.width * scaleFactor)
            const expectedHeight = Math.round(phoneCaseDimensions.height * scaleFactor)
            
            return {
                input: phoneCaseDimensions,
                scaleFactor,
                expectedContainer: { width: expectedWidth, height: expectedHeight },
                calculations: {
                    aspectRatio: (phoneCaseDimensions.width / phoneCaseDimensions.height).toFixed(3)
                }
            }
        }

        function testPreviewDimensionsCalculation(phoneCaseDimensions) {
            const scaleFactor = 8
            const marginX = 0.84
            const marginY = 0.98
            
            const expectedWidth = phoneCaseDimensions.width * scaleFactor * marginX
            const expectedHeight = phoneCaseDimensions.height * scaleFactor * marginY
            
            return {
                input: phoneCaseDimensions,
                scaleFactor,
                margins: { x: marginX, y: marginY },
                expectedPreview: { width: expectedWidth, height: expectedHeight },
                calculations: {
                    aspectRatio: (phoneCaseDimensions.width / phoneCaseDimensions.height).toFixed(3)
                }
            }
        }

        function runDimensionTests() {
            const results = {
                testCount: TEST_PHONE_MODELS.length,
                models: [],
                summary: {
                    canvasRange: { minWidth: Infinity, maxWidth: 0, minHeight: Infinity, maxHeight: 0 },
                    containerRange: { minWidth: Infinity, maxWidth: 0, minHeight: Infinity, maxHeight: 0 },
                    previewRange: { minWidth: Infinity, maxWidth: 0, minHeight: Infinity, maxHeight: 0 },
                    aspectRatios: []
                }
            }
            
            TEST_PHONE_MODELS.forEach(model => {
                const dimensions = {
                    width: parseFloat(model.width),
                    height: parseFloat(model.height)
                }
                
                const canvasTest = testCanvasDimensionsCalculation(dimensions)
                const containerTest = testContainerDimensionsCalculation(dimensions)
                const previewTest = testPreviewDimensionsCalculation(dimensions)
                
                const modelResult = {
                    name: model.mobile_model_name,
                    id: model.mobile_model_id,
                    inputDimensions: dimensions,
                    canvasTest,
                    containerTest,
                    previewTest
                }
                
                results.models.push(modelResult)
                
                // Update summary ranges
                const canvas = canvasTest.expectedCanvas
                const container = containerTest.expectedContainer
                const preview = previewTest.expectedPreview
                
                results.summary.canvasRange.minWidth = Math.min(results.summary.canvasRange.minWidth, canvas.width)
                results.summary.canvasRange.maxWidth = Math.max(results.summary.canvasRange.maxWidth, canvas.width)
                results.summary.canvasRange.minHeight = Math.min(results.summary.canvasRange.minHeight, canvas.height)
                results.summary.canvasRange.maxHeight = Math.max(results.summary.canvasRange.maxHeight, canvas.height)
                
                results.summary.containerRange.minWidth = Math.min(results.summary.containerRange.minWidth, container.width)
                results.summary.containerRange.maxWidth = Math.max(results.summary.containerRange.maxWidth, container.width)
                results.summary.containerRange.minHeight = Math.min(results.summary.containerRange.minHeight, container.height)
                results.summary.containerRange.maxHeight = Math.max(results.summary.containerRange.maxHeight, container.height)
                
                results.summary.previewRange.minWidth = Math.min(results.summary.previewRange.minWidth, preview.width)
                results.summary.previewRange.maxWidth = Math.max(results.summary.previewRange.maxWidth, preview.width)
                results.summary.previewRange.minHeight = Math.min(results.summary.previewRange.minHeight, preview.height)
                results.summary.previewRange.maxHeight = Math.max(results.summary.previewRange.maxHeight, preview.height)
                
                results.summary.aspectRatios.push({
                    model: model.mobile_model_name,
                    ratio: parseFloat(canvasTest.calculations.aspectRatio)
                })
            })
            
            return results
        }

        function displayResults(results) {
            const container = document.getElementById('results-container')
            
            let html = `
                <div class="summary">
                    <h2>🧪 Test Summary</h2>
                    <p><strong>Models Tested:</strong> ${results.testCount}</p>
                    <p><strong>Canvas Range:</strong> ${results.summary.canvasRange.minWidth}-${results.summary.canvasRange.maxWidth}px wide, ${results.summary.canvasRange.minHeight}-${results.summary.canvasRange.maxHeight}px tall</p>
                    <p><strong>Container Range:</strong> ${results.summary.containerRange.minWidth}-${results.summary.containerRange.maxWidth}px wide, ${results.summary.containerRange.minHeight}-${results.summary.containerRange.maxHeight}px tall</p>
                    <p><strong>Preview Range:</strong> ${Math.round(results.summary.previewRange.minWidth)}-${Math.round(results.summary.previewRange.maxWidth)}px wide, ${Math.round(results.summary.previewRange.minHeight)}-${Math.round(results.summary.previewRange.maxHeight)}px tall</p>
                </div>
            `
            
            results.models.forEach((model, index) => {
                html += `
                    <div class="test-model">
                        <h3>${index + 1}. ${model.name}</h3>
                        <p><strong>Input:</strong> ${model.inputDimensions.width}mm × ${model.inputDimensions.height}mm</p>
                        <div class="dimensions-row">
                            <div class="dimension-item">
                                <div class="dimension-label">Canvas (Print)</div>
                                ${model.canvasTest.expectedCanvas.width}px × ${model.canvasTest.expectedCanvas.height}px
                            </div>
                            <div class="dimension-item">
                                <div class="dimension-label">Container (UI)</div>
                                ${model.containerTest.expectedContainer.width}px × ${model.containerTest.expectedContainer.height}px
                            </div>
                            <div class="dimension-item">
                                <div class="dimension-label">Preview</div>
                                ${Math.round(model.previewTest.expectedPreview.width)}px × ${Math.round(model.previewTest.expectedPreview.height)}px
                            </div>
                            <div class="dimension-item">
                                <div class="dimension-label">Aspect Ratio</div>
                                ${model.canvasTest.calculations.aspectRatio}
                            </div>
                        </div>
                    </div>
                `
            })
            
            container.innerHTML = html
        }

        function logToConsoleOutput(message) {
            const consoleOutput = document.getElementById('console-output')
            consoleOutput.style.display = 'block'
            consoleOutput.textContent += message + '\n'
        }

        window.runTests = function() {
            // Clear previous results
            document.getElementById('console-output').textContent = ''
            
            logToConsoleOutput('🧪 Running Phone Case Dimension Integration Tests...\n')
            
            const results = runDimensionTests()
            
            // Display visual results
            displayResults(results)
            
            // Log detailed results to console output
            logToConsoleOutput('='.repeat(80))
            logToConsoleOutput('PHONE CASE DIMENSION INTEGRATION TEST RESULTS')
            logToConsoleOutput('='.repeat(80))
            
            logToConsoleOutput(`\n📱 Tested ${results.testCount} phone models:\n`)
            
            results.models.forEach((model, index) => {
                logToConsoleOutput(`${index + 1}. ${model.name} (${model.inputDimensions.width}mm x ${model.inputDimensions.height}mm)`)
                logToConsoleOutput(`   Canvas: ${model.canvasTest.expectedCanvas.width}px x ${model.canvasTest.expectedCanvas.height}px`)
                logToConsoleOutput(`   Container: ${model.containerTest.expectedContainer.width}px x ${model.containerTest.expectedContainer.height}px`)
                logToConsoleOutput(`   Preview: ${model.previewTest.expectedPreview.width.toFixed(1)}px x ${model.previewTest.expectedPreview.height.toFixed(1)}px`)
                logToConsoleOutput(`   Aspect Ratio: ${model.canvasTest.calculations.aspectRatio}`)
                logToConsoleOutput('')
            })
            
            logToConsoleOutput('📊 SUMMARY RANGES:')
            logToConsoleOutput(`Canvas: ${results.summary.canvasRange.minWidth}-${results.summary.canvasRange.maxWidth}px wide, ${results.summary.canvasRange.minHeight}-${results.summary.canvasRange.maxHeight}px tall`)
            logToConsoleOutput(`Container: ${results.summary.containerRange.minWidth}-${results.summary.containerRange.maxWidth}px wide, ${results.summary.containerRange.minHeight}-${results.summary.containerRange.maxHeight}px tall`)
            logToConsoleOutput(`Preview: ${results.summary.previewRange.minWidth.toFixed(0)}-${results.summary.previewRange.maxWidth.toFixed(0)}px wide, ${results.summary.previewRange.minHeight.toFixed(0)}-${results.summary.previewRange.maxHeight.toFixed(0)}px tall`)
            
            const aspectRatios = results.summary.aspectRatios.map(ar => ar.ratio).sort((a, b) => a - b)
            logToConsoleOutput(`\n📐 Aspect Ratios: ${aspectRatios.join(', ')} (${aspectRatios[0]}-${aspectRatios[aspectRatios.length-1]} range)`)
            
            logToConsoleOutput('\n✅ All dimension calculations completed successfully!')
            logToConsoleOutput('='.repeat(80))
            
            console.log('✅ Phone Case Dimension Tests Completed!')
            console.log('📊 Results displayed above and logged to console output')
        }
    </script>
</body>
</html>